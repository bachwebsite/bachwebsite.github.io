window.DOMHandler=class{constructor(b,a){this._iRuntime=b;this._componentId=a;this._hasTickCallback=!1;this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(b,a,c,d){this._iRuntime.PostToRuntimeComponent(this._componentId,b,a,c,d)}PostToRuntimeAsync(b,a,c,d){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,b,a,c,d)}_PostToRuntimeMaybeSync(b,a,c){this._iRuntime.UsesWorker()?this.PostToRuntime(b,a,c):this._iRuntime._GetLocalRuntime()._OnMessageFromDOM({type:"event",component:this._componentId,
handler:b,dispatchOpts:c||null,data:a,responseId:null})}AddRuntimeMessageHandler(b,a){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,b,a)}AddRuntimeMessageHandlers(b){for(const [a,c]of b)this.AddRuntimeMessageHandler(a,c)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&(this._iRuntime._RemoveRAFCallback(this._tickCallback),
this._hasTickCallback=!1)}Tick(){}};
window.RateLimiter=class{constructor(b,a){this._callback=b;this._interval=a;this._timerId=-1;this._lastCallTime=-Infinity;this._timerCallFunc=()=>this._OnTimer();this._canRunImmediate=this._ignoreReset=!1}SetCanRunImmediate(b){this._canRunImmediate=!!b}Call(){if(-1===this._timerId){var b=Date.now(),a=b-this._lastCallTime,c=this._interval;a>=c&&this._canRunImmediate?(this._lastCallTime=b,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(c-a,4))}}_RunCallback(){this._ignoreReset=
!0;this._callback();this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1;this._lastCallTime=Date.now();this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer();this._timerCallFunc=this._callback=null}};"use strict";
class ElementState{constructor(b){this._elem=b;this._hadFirstUpdate=!1;this._isVisibleFlag=!0}SetVisibleFlag(b){this._isVisibleFlag=!!b}GetVisibleFlag(){return this._isVisibleFlag}HadFirstUpdate(){return this._hadFirstUpdate}SetHadFirstUpdate(){this._hadFirstUpdate=!0}GetElement(){return this._elem}}
window.DOMElementHandler=class extends self.DOMHandler{constructor(b,a){super(b,a);this._elementMap=new Map;this._autoAttach=!0;this.AddRuntimeMessageHandlers([["create",c=>this._OnCreate(c)],["destroy",c=>this._OnDestroy(c)],["set-visible",c=>this._OnSetVisible(c)],["update-position",c=>this._OnUpdatePosition(c)],["update-state",c=>this._OnUpdateState(c)],["focus",c=>this._OnSetFocus(c)],["set-css-style",c=>this._OnSetCssStyle(c)],["set-attribute",c=>this._OnSetAttribute(c)],["remove-attribute",
c=>this._OnRemoveAttribute(c)]]);this.AddDOMElementMessageHandler("get-element",c=>c)}SetAutoAttach(b){this._autoAttach=!!b}AddDOMElementMessageHandler(b,a){this.AddRuntimeMessageHandler(b,c=>{const d=this.GetElementById(c.elementId);return a(d,c)})}_OnCreate(b){const a=b.elementId,c=this.CreateElement(a,b),d=new ElementState(c);this._elementMap.set(a,d);c.style.boxSizing="border-box";c.style.display="none";d.SetVisibleFlag(b.isVisible);b=this._GetFocusElement(c);b.addEventListener("focus",e=>this._OnFocus(a));
b.addEventListener("blur",e=>this._OnBlur(a));this._autoAttach&&document.body.appendChild(c)}CreateElement(b,a){throw Error("required override");}DestroyElement(b){}_OnDestroy(b){b=b.elementId;const a=this.GetElementById(b);this.DestroyElement(a);this._autoAttach&&a.parentElement.removeChild(a);this._elementMap.delete(b)}PostToRuntimeElement(b,a,c){c||(c={});c.elementId=a;this.PostToRuntime(b,c)}_PostToRuntimeElementMaybeSync(b,a,c){c||(c={});c.elementId=a;this._PostToRuntimeMaybeSync(b,c)}_OnSetVisible(b){if(this._autoAttach){var a=
this._elementMap.get(b.elementId),c=a.GetElement();a.HadFirstUpdate()?c.style.display=b.isVisible?"":"none":a.SetVisibleFlag(b.isVisible)}}_OnUpdatePosition(b){if(this._autoAttach){var a=this._elementMap.get(b.elementId),c=a.GetElement();c.style.left=b.left+"px";c.style.top=b.top+"px";c.style.width=b.width+"px";c.style.height=b.height+"px";b=b.fontSize;null!==b&&(c.style.fontSize=b+"em");a.HadFirstUpdate()||(a.SetHadFirstUpdate(),a.GetVisibleFlag()&&(c.style.display=""))}}_OnUpdateState(b){const a=
this.GetElementById(b.elementId);this.UpdateState(a,b)}UpdateState(b,a){throw Error("required override");}_GetFocusElement(b){return b}_OnFocus(b){this.PostToRuntimeElement("elem-focused",b)}_OnBlur(b){this.PostToRuntimeElement("elem-blurred",b)}_OnSetFocus(b){const a=this._GetFocusElement(this.GetElementById(b.elementId));b.focus?a.focus():a.blur()}_OnSetCssStyle(b){const a=this.GetElementById(b.elementId),c=b.prop;b=b.val;c.startsWith("--")?a.style.setProperty(c,b):a.style[c]=b}_OnSetAttribute(b){this.GetElementById(b.elementId).setAttribute(b.name,
b.val)}_OnRemoveAttribute(b){this.GetElementById(b.elementId).removeAttribute(b.name)}GetElementById(b){const a=this._elementMap.get(b);if(!a)throw Error(`no element with id ${b}`);return a.GetElement()}};"use strict";const isiOSLike=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),isAndroid=/android/i.test(navigator.userAgent),isSafari=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/|nwjs)/i.test(navigator.userAgent);let resolveCounter=0;
function AddScript(b){const a=document.createElement("script");a.async=!1;a.type="module";return b.isStringSrc?new Promise(c=>{const d="c3_resolve_"+resolveCounter;++resolveCounter;self[d]=c;a.textContent=b.str+`\n\nself["${d}"]();`;document.head.appendChild(a)}):new Promise((c,d)=>{a.onload=c;a.onerror=d;a.src=b;document.head.appendChild(a)})}let didCheckWorkerModuleSupport=!1,isWorkerModuleSupported=!1;
function SupportsWorkerTypeModule(){if(!didCheckWorkerModuleSupport){try{new Worker("blob://",{get type(){isWorkerModuleSupported=!0}})}catch(b){}didCheckWorkerModuleSupport=!0}return isWorkerModuleSupported}let tmpAudio=new Audio;
const supportedAudioFormats={"audio/webm; codecs=opus":!!tmpAudio.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!tmpAudio.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!tmpAudio.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!tmpAudio.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!tmpAudio.canPlayType("audio/mp4"),"audio/mpeg":!!tmpAudio.canPlayType("audio/mpeg")};tmpAudio=null;
async function BlobToString(b){b=await BlobToArrayBuffer(b);return(new TextDecoder("utf-8")).decode(b)}function BlobToArrayBuffer(b){return new Promise((a,c)=>{const d=new FileReader;d.onload=e=>a(e.target.result);d.onerror=e=>c(e);d.readAsArrayBuffer(b)})}const queuedArrayBufferReads=[];let activeArrayBufferReads=0;window.RealFile=window.File;const domHandlerClasses=[],runtimeEventHandlers=new Map,pendingResponsePromises=new Map;let nextResponseId=0;const runOnStartupFunctions=[];
self.runOnStartup=function(b){if("function"!==typeof b)throw Error("runOnStartup called without a function");runOnStartupFunctions.push(b)};const WEBVIEW_EXPORT_TYPES=new Set(["cordova","playable-ad","instant-games"]);function IsWebViewExportType(b){return WEBVIEW_EXPORT_TYPES.has(b)}let isWrapperFullscreen=!1;
window.RuntimeInterface=class b{constructor(a){this._useWorker=a.useWorker;this._messageChannelPort=null;this._runtimeBaseUrl="";this._scriptFolder=a.scriptFolder;this._workerScriptURLs={};this._localRuntime=this._worker=null;this._domHandlers=[];this._canvas=this._runtimeDomHandler=null;this._isExportingToVideo=!1;this._exportToVideoDuration=0;this._jobScheduler=null;this._rafId=-1;this._rafFunc=()=>this._OnRAFCallback();this._rafCallbacks=[];this._wrapperInitResolve=null;this._wrapperComponentIds=
[];this._exportType=a.exportType;this._isFileProtocol="file"===location.protocol.substr(0,4);!this._useWorker||"undefined"!==typeof OffscreenCanvas&&navigator.userActivation&&SupportsWorkerTypeModule()||(this._useWorker=!1);this._useWorker&&isSafari&&(this._useWorker=!1);if("playable-ad"===this._exportType||"instant-games"===this._exportType)this._useWorker=!1;if("cordova"===this._exportType&&this._useWorker)if(isAndroid){const c=/Chrome\/(\d+)/i.exec(navigator.userAgent);c&&90<=parseInt(c[1],10)||
(this._useWorker=!1)}else this._useWorker=!1;this.IsWebView2Wrapper()?self.chrome.webview.addEventListener("message",c=>this._OnWrapperMessage(c.data)):"macos-wkwebview"===this._exportType&&(self.C3WrapperOnMessage=c=>this._OnWrapperMessage(c));this._localFileStrings=this._localFileBlobs=null;"html5"!==this._exportType||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available.");
this.AddRuntimeComponentMessageHandler("runtime","cordova-fetch-local-file",c=>this._OnCordovaFetchLocalFile(c));this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",c=>this._OnCreateJobWorker(c));this.AddRuntimeComponentMessageHandler("runtime","send-wrapper-extension-message",c=>this._OnSendWrapperExtensionMessage(c));"cordova"===this._exportType?document.addEventListener("deviceready",()=>this._Init(a)):this._Init(a)}Release(){this._CancelAnimationFrame();this._messageChannelPort&&
(this._messageChannelPort=this._messageChannelPort.onmessage=null);this._worker&&(this._worker.terminate(),this._worker=null);this._localRuntime&&(this._localRuntime.Release(),this._localRuntime=null);this._canvas&&(this._canvas.parentElement.removeChild(this._canvas),this._canvas=null)}GetCanvas(){return this._canvas}GetRuntimeBaseURL(){return this._runtimeBaseUrl}UsesWorker(){return this._useWorker}GetExportType(){return this._exportType}IsFileProtocol(){return this._isFileProtocol}GetScriptFolder(){return this._scriptFolder}IsiOSCordova(){return isiOSLike&&
"cordova"===this._exportType}IsiOSWebView(){const a=navigator.userAgent;return isiOSLike&&IsWebViewExportType(this._exportType)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(a)}IsAndroid(){return isAndroid}IsAndroidWebView(){return isAndroid&&IsWebViewExportType(this._exportType)}IsWebView2Wrapper(){return"windows-webview2"===this._exportType||!!("preview"===this._exportType&&window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage)}async _Init(a){"macos-wkwebview"===this._exportType?
this._SendWrapperMessage({type:"ready"}):this.IsWebView2Wrapper()&&(this._SetupWebView2Polyfills(),this._wrapperComponentIds=(await this._InitWrapper()).registeredComponentIds);if("playable-ad"===this._exportType){this._localFileBlobs=self.c3_base64files;this._localFileStrings={};await this._ConvertDataUrisToBlobs();for(let d=0,e=a.engineScripts.length;d<e;++d){var c=a.engineScripts[d];this._localFileStrings.hasOwnProperty(c)?a.engineScripts[d]={isStringSrc:!0,str:this._localFileStrings[c]}:this._localFileBlobs.hasOwnProperty(c)&&
(a.engineScripts[d]=URL.createObjectURL(this._localFileBlobs[c]))}a.workerDependencyScripts=[]}if("nwjs"===this._exportType&&self.nw&&self.nw.App.manifest["c3-steam-mode"]){let d=0;this._AddRAFCallback(()=>{d++;document.body.style.opacity=0===d%2?"1":"0.999"})}a.runtimeBaseUrl?this._runtimeBaseUrl=a.runtimeBaseUrl:(c=location.origin,this._runtimeBaseUrl=("null"===c?"file:///":c)+location.pathname,c=this._runtimeBaseUrl.lastIndexOf("/"),-1!==c&&(this._runtimeBaseUrl=this._runtimeBaseUrl.substr(0,c+
1)));a.workerScripts&&(this._workerScriptURLs=a.workerScripts);c=new MessageChannel;this._messageChannelPort=c.port1;this._messageChannelPort.onmessage=d=>this._OnMessageFromRuntime(d.data);window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(d=>this._OnMessageFromDebugger(d));this._jobScheduler=new self.JobSchedulerDOM(this);await this._jobScheduler.Init();"object"===typeof window.StatusBar&&window.StatusBar.hide();if("object"===typeof window.AndroidFullScreen)try{await new Promise((d,
e)=>{window.AndroidFullScreen.immersiveMode(d,e)})}catch(d){console.error("Failed to enter Android immersive mode: ",d)}this._useWorker?await this._InitWorker(a,c.port2):await this._InitDOM(a,c.port2)}_GetWorkerURL(a){a=this._workerScriptURLs.hasOwnProperty(a)?this._workerScriptURLs[a]:a.endsWith("/workermain.js")&&this._workerScriptURLs.hasOwnProperty("workermain.js")?this._workerScriptURLs["workermain.js"]:"playable-ad"===this._exportType&&this._localFileBlobs.hasOwnProperty(a)?this._localFileBlobs[a]:
a;a instanceof Blob&&(a=URL.createObjectURL(a));return a}async CreateWorker(a,c,d){if(a.startsWith("blob:"))return new Worker(a,d);if("cordova"===this._exportType&&this._isFileProtocol)return a=await this.CordovaFetchLocalFileAsArrayBuffer(d.isC3MainWorker?a:this._scriptFolder+a),a=new Blob([a],{type:"application/javascript"}),new Worker(URL.createObjectURL(a),d);a=new URL(a,c);if(location.origin!==a.origin){a=await fetch(a);if(!a.ok)throw Error("failed to fetch worker script");a=await a.blob();return new Worker(URL.createObjectURL(a),
d)}return new Worker(a,d)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,1)}_GetCommonRuntimeOptions(a){return{runtimeBaseUrl:this._runtimeBaseUrl,previewUrl:location.href,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),devicePixelRatio:window.devicePixelRatio,isFullscreen:b.IsDocumentFullscreen(),projectData:a.projectData,previewImageBlobs:window.cr_previewImageBlobs||this._localFileBlobs,
previewProjectFileBlobs:window.cr_previewProjectFileBlobs,previewProjectFileSWUrls:window.cr_previewProjectFiles,swClientId:window.cr_swClientId||"",exportType:a.exportType,isDebug:(new URLSearchParams(self.location.search)).has("debug"),ife:!!self.ife,jobScheduler:this._jobScheduler.GetPortData(),supportedAudioFormats,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||this._scriptFolder+"opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||this._scriptFolder+"opus.wasm.wasm",isFileProtocol:this._isFileProtocol,
isiOSCordova:this.IsiOSCordova(),isiOSWebView:this.IsiOSWebView(),isWebView2Wrapper:this.IsWebView2Wrapper(),wrapperComponentIds:this._wrapperComponentIds,isFBInstantAvailable:"undefined"!==typeof self.FBInstant}}async _InitWorker(a,c){const d=this._GetWorkerURL(a.workerMainUrl);"preview"===this._exportType?(this._worker=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((h,k)=>{const l=m=>{this._worker.removeEventListener("message",l);m.data&&"ok"===m.data.type?h():k()};
this._worker.addEventListener("message",l);this._worker.postMessage({type:"construct-worker-init","import":(new URL(d,this._runtimeBaseUrl)).toString()})})):this._worker=await this.CreateWorker(d,this._runtimeBaseUrl,{type:"module",name:"Runtime",isC3MainWorker:!0});this._canvas=document.createElement("canvas");this._canvas.style.display="none";const e=this._canvas.transferControlToOffscreen();document.body.appendChild(this._canvas);window.c3canvas=this._canvas;self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders();
let f=a.workerDependencyScripts||[],g=a.engineScripts;f=await Promise.all(f.map(h=>this._MaybeGetCordovaScriptURL(h)));g=await Promise.all(g.map(h=>this._MaybeGetCordovaScriptURL(h)));if("cordova"===this._exportType)for(let h=0,k=a.projectScripts.length;h<k;++h){const l=a.projectScripts[h],m=l[0];if(m===a.mainProjectScript||"scriptsInEvents.js"===m||m.endsWith("/scriptsInEvents.js"))l[1]=await this._MaybeGetCordovaScriptURL(m)}this._worker.postMessage(Object.assign(this._GetCommonRuntimeOptions(a),
{type:"init-runtime",isInWorker:!0,messagePort:c,canvas:e,workerDependencyScripts:f,engineScripts:g,projectScripts:a.projectScripts,mainProjectScript:a.mainProjectScript,projectScriptsStatus:self.C3_ProjectScriptsStatus}),[c,e,...this._jobScheduler.GetPortTransferables()]);this._domHandlers=domHandlerClasses.map(h=>new h(this));this._FindRuntimeDOMHandler();this._runtimeDomHandler._EnableWindowResizeEvent();self.c3_callFunction=(h,k)=>this._runtimeDomHandler._InvokeFunctionFromJS(h,k);"preview"===
this._exportType&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async _InitDOM(a,c){this._canvas=document.createElement("canvas");this._canvas.style.display="none";document.body.appendChild(this._canvas);window.c3canvas=this._canvas;self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders();this._domHandlers=domHandlerClasses.map(g=>new g(this));this._FindRuntimeDOMHandler();var d=a.engineScripts.map(g=>"string"===typeof g?(new URL(g,this._runtimeBaseUrl)).toString():
g);if(Array.isArray(a.workerDependencyScripts)){var e=[...a.workerDependencyScripts].map(g=>g instanceof Blob?URL.createObjectURL(g):g);d.unshift(...e)}d=await Promise.all(d.map(g=>this._MaybeGetCordovaScriptURL(g)));await Promise.all(d.map(g=>AddScript(g)));d=self.C3_ProjectScriptsStatus;e=a.mainProjectScript;const f=a.projectScripts;for(let [g,h]of f)if(h||(h=g),g===e)try{h=await this._MaybeGetCordovaScriptURL(h),await AddScript(h),"preview"!==this._exportType||d[g]||this._ReportProjectMainScriptError(g,
"main script did not run to completion")}catch(k){this._ReportProjectMainScriptError(g,k)}else if("scriptsInEvents.js"===g||g.endsWith("/scriptsInEvents.js"))h=await this._MaybeGetCordovaScriptURL(h),await AddScript(h);"preview"===this._exportType&&"object"!==typeof self.C3.ScriptsInEvents?(this._RemoveLoadingMessage(),console.error("[C3 runtime] Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax."),alert("Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax.")):
(a=Object.assign(this._GetCommonRuntimeOptions(a),{isInWorker:!1,messagePort:c,canvas:this._canvas,runOnStartupFunctions}),this._runtimeDomHandler._EnableWindowResizeEvent(),this._OnBeforeCreateRuntime(),this._localRuntime=self.C3_CreateRuntime(a),await self.C3_InitRuntime(this._localRuntime,a))}_ReportProjectMainScriptError(a,c){this._RemoveLoadingMessage();console.error(`[Preview] Failed to load project main script (${a}): `,c);alert(`Failed to load project main script (${a}). Check all your JavaScript code has valid syntax. Press F12 and check the console for error details.`)}_OnBeforeCreateRuntime(){this._RemoveLoadingMessage()}_RemoveLoadingMessage(){const a=
window.cr_previewLoadingElem;a&&(a.parentElement.removeChild(a),window.cr_previewLoadingElem=null)}async _OnCreateJobWorker(a){a=await this._jobScheduler._CreateJobWorker();return{outputPort:a,transferables:[a]}}_GetLocalRuntime(){if(this._useWorker)throw Error("not available in worker mode");return this._localRuntime}PostToRuntimeComponent(a,c,d,e,f){this._messageChannelPort.postMessage({type:"event",component:a,handler:c,dispatchOpts:e||null,data:d,responseId:null},f)}PostToRuntimeComponentAsync(a,
c,d,e,f){const g=nextResponseId++,h=new Promise((k,l)=>{pendingResponsePromises.set(g,{resolve:k,reject:l})});this._messageChannelPort.postMessage({type:"event",component:a,handler:c,dispatchOpts:e||null,data:d,responseId:g},f);return h}_OnMessageFromRuntime(a){const c=a.type;if("event"===c)return this._OnEventFromRuntime(a);if("result"===c)this._OnResultFromRuntime(a);else if("runtime-ready"===c)this._OnRuntimeReady();else if("alert-error"===c)this._RemoveLoadingMessage(),alert(a.message);else if("creating-runtime"===
c)this._OnBeforeCreateRuntime();else throw Error(`unknown message '${c}'`);}_OnEventFromRuntime(a){const c=a.component,d=a.handler,e=a.data,f=a.responseId;if(a=runtimeEventHandlers.get(c))if(a=a.get(d)){var g=null;try{g=a(e)}catch(h){console.error(`Exception in '${c}' handler '${d}':`,h);null!==f&&this._PostResultToRuntime(f,!1,""+h);return}if(null===f)return g;g&&g.then?g.then(h=>this._PostResultToRuntime(f,!0,h)).catch(h=>{console.error(`Rejection from '${c}' handler '${d}':`,h);this._PostResultToRuntime(f,
!1,""+h)}):this._PostResultToRuntime(f,!0,g)}else console.warn(`[DOM] No handler '${d}' for component '${c}'`);else console.warn(`[DOM] No event handlers for component '${c}'`)}_PostResultToRuntime(a,c,d){let e;d&&d.transferables&&(e=d.transferables);this._messageChannelPort.postMessage({type:"result",responseId:a,isOk:c,result:d},e)}_OnResultFromRuntime(a){const c=a.responseId,d=a.isOk;a=a.result;const e=pendingResponsePromises.get(c);d?e.resolve(a):e.reject(a);pendingResponsePromises.delete(c)}AddRuntimeComponentMessageHandler(a,
c,d){let e=runtimeEventHandlers.get(a);e||(e=new Map,runtimeEventHandlers.set(a,e));if(e.has(c))throw Error(`[DOM] Component '${a}' already has handler '${c}'`);e.set(c,d)}static AddDOMHandlerClass(a){if(domHandlerClasses.includes(a))throw Error("DOM handler already added");domHandlerClasses.push(a)}_FindRuntimeDOMHandler(){for(const a of this._domHandlers)if("runtime"===a.GetComponentID()){this._runtimeDomHandler=a;return}throw Error("cannot find runtime DOM handler");}_OnMessageFromDebugger(a){this.PostToRuntimeComponent("debugger",
"message",a)}_OnRuntimeReady(){for(const a of this._domHandlers)a.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||isWrapperFullscreen)}static _SetWrapperIsFullscreenFlag(a){isWrapperFullscreen=!!a}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(a){this._rafCallbacks.push(a);this._RequestAnimationFrame()}_RemoveRAFCallback(a){a=
this._rafCallbacks.indexOf(a);if(-1===a)throw Error("invalid callback");this._rafCallbacks.splice(a,1);this._rafCallbacks.length||this._CancelAnimationFrame()}_RequestAnimationFrame(){-1===this._rafId&&this._rafCallbacks.length&&(this._rafId=requestAnimationFrame(this._rafFunc))}_CancelAnimationFrame(){-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1)}_OnRAFCallback(){this._rafId=-1;for(const a of this._rafCallbacks)a();this._RequestAnimationFrame()}TryPlayMedia(a){this._runtimeDomHandler.TryPlayMedia(a)}RemovePendingPlay(a){this._runtimeDomHandler.RemovePendingPlay(a)}_PlayPendingMedia(){this._runtimeDomHandler._PlayPendingMedia()}SetSilent(a){this._runtimeDomHandler.SetSilent(a)}IsAudioFormatSupported(a){return!!supportedAudioFormats[a]}async _WasmDecodeWebMOpus(a){a=
await this.PostToRuntimeComponentAsync("runtime","opus-decode",{arrayBuffer:a},null,[a]);return new Float32Array(a)}SetIsExportingToVideo(a){this._isExportingToVideo=!0;this._exportToVideoDuration=a}IsExportingToVideo(){return this._isExportingToVideo}GetExportToVideoDuration(){return this._exportToVideoDuration}IsAbsoluteURL(a){return/^(?:[a-z\-]+:)?\/\//.test(a)||"data:"===a.substr(0,5)||"blob:"===a.substr(0,5)}IsRelativeURL(a){return!this.IsAbsoluteURL(a)}async _MaybeGetCordovaScriptURL(a){return"cordova"===
this._exportType&&(a.startsWith("file:")||this._isFileProtocol&&this.IsRelativeURL(a))?(a.startsWith(this._runtimeBaseUrl)&&(a=a.substr(this._runtimeBaseUrl.length)),a=await this.CordovaFetchLocalFileAsArrayBuffer(a),a=new Blob([a],{type:"application/javascript"}),URL.createObjectURL(a)):a}async _OnCordovaFetchLocalFile(a){const c=a.filename;switch(a.as){case "text":return await this.CordovaFetchLocalFileAsText(c);case "buffer":return await this.CordovaFetchLocalFileAsArrayBuffer(c);default:throw Error("unsupported type");
}}_GetPermissionAPI(){const a=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if("object"!==typeof a)throw Error("Permission API is not loaded");return a}_MapPermissionID(a,c){a=a[c];if("string"!==typeof a)throw Error("Invalid permission name");return a}_HasPermission(a){const c=this._GetPermissionAPI();return new Promise((d,e)=>c.checkPermission(this._MapPermissionID(c,a),f=>d(!!f.hasPermission),e))}_RequestPermission(a){const c=this._GetPermissionAPI();return new Promise((d,
e)=>c.requestPermission(this._MapPermissionID(c,a),f=>d(!!f.hasPermission),e))}async RequestPermissions(a){if("cordova"!==this.GetExportType()||this.IsiOSCordova())return!0;for(const c of a)if(!await this._HasPermission(c)&&!1===await this._RequestPermission(c))return!1;return!0}async RequirePermissions(...a){if(!1===await this.RequestPermissions(a))throw Error("Permission not granted");}CordovaFetchLocalFile(a){const c=window.cordova.file.applicationDirectory+"www/"+a;return new Promise((d,e)=>{window.resolveLocalFileSystemURL(c,
f=>{f.file(d,e)},e)})}async CordovaFetchLocalFileAsText(a){a=await this.CordovaFetchLocalFile(a);return await BlobToString(a)}_CordovaMaybeStartNextArrayBufferRead(){if(queuedArrayBufferReads.length&&!(8<=activeArrayBufferReads)){activeArrayBufferReads++;var a=queuedArrayBufferReads.shift();this._CordovaDoFetchLocalFileAsAsArrayBuffer(a.filename,a.successCallback,a.errorCallback)}}CordovaFetchLocalFileAsArrayBuffer(a){return new Promise((c,d)=>{queuedArrayBufferReads.push({filename:a,successCallback:e=>
{activeArrayBufferReads--;this._CordovaMaybeStartNextArrayBufferRead();c(e)},errorCallback:e=>{activeArrayBufferReads--;this._CordovaMaybeStartNextArrayBufferRead();d(e)}});this._CordovaMaybeStartNextArrayBufferRead()})}async _CordovaDoFetchLocalFileAsAsArrayBuffer(a,c,d){try{const e=await this.CordovaFetchLocalFile(a),f=await BlobToArrayBuffer(e);c(f)}catch(e){d(e)}}_OnWrapperMessage(a){if("entered-fullscreen"===a)b._SetWrapperIsFullscreenFlag(!0),this._runtimeDomHandler._OnFullscreenChange();else if("exited-fullscreen"===
a)b._SetWrapperIsFullscreenFlag(!1),this._runtimeDomHandler._OnFullscreenChange();else if("object"===typeof a){const c=a.type;"wrapper-init-response"===c?(this._wrapperInitResolve(a),this._wrapperInitResolve=null):"extension-message"===c?this.PostToRuntimeComponent("runtime","wrapper-extension-message",a):console.warn("Unknown wrapper message: ",a)}else console.warn("Unknown wrapper message: ",a)}_OnSendWrapperExtensionMessage(a){this._SendWrapperMessage({type:"extension-message",componentId:a.componentId,
messageId:a.messageId,params:a.params||[],asyncId:a.asyncId})}_SendWrapperMessage(a){this.IsWebView2Wrapper()?window.chrome.webview.postMessage(JSON.stringify(a)):"macos-wkwebview"===this._exportType&&window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(a))}_SetupWebView2Polyfills(){window.moveTo=(a,c)=>{this._SendWrapperMessage({type:"set-window-position",windowX:Math.ceil(a),windowY:Math.ceil(c)})};window.resizeTo=(a,c)=>{this._SendWrapperMessage({type:"set-window-size",windowWidth:Math.ceil(a),
windowHeight:Math.ceil(c)})}}_InitWrapper(){return this.IsWebView2Wrapper()?new Promise(a=>{this._wrapperInitResolve=a;this._SendWrapperMessage({type:"wrapper-init"})}):Promise.resolve()}async _ConvertDataUrisToBlobs(){const a=[];for(const [c,d]of Object.entries(this._localFileBlobs))a.push(this._ConvertDataUriToBlobs(c,d));await Promise.all(a)}async _ConvertDataUriToBlobs(a,c){if("object"===typeof c)this._localFileBlobs[a]=new Blob([c.str],{type:c.type}),this._localFileStrings[a]=c.str;else{let d=
await this._FetchDataUri(c);d||(d=this._DataURIToBinaryBlobSync(c));this._localFileBlobs[a]=d}}async _FetchDataUri(a){try{return await (await fetch(a)).blob()}catch(c){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",c),null}}_DataURIToBinaryBlobSync(a){a=this._ParseDataURI(a);return this._BinaryStringToBlob(a.data,a.mime_type)}_ParseDataURI(a){var c=
a.indexOf(",");if(0>c)throw new URIError("expected comma in data: uri");var d=a.substring(5,c);a=a.substring(c+1);c=d.split(";");d=c[0]||"";const e=c[2];a="base64"===c[1]||"base64"===e?atob(a):decodeURIComponent(a);return{mime_type:d,data:a}}_BinaryStringToBlob(a,c){var d=a.length;let e=d>>2,f=new Uint8Array(d),g=new Uint32Array(f.buffer,0,e),h,k;for(k=h=0;h<e;++h)g[h]=a.charCodeAt(k++)|a.charCodeAt(k++)<<8|a.charCodeAt(k++)<<16|a.charCodeAt(k++)<<24;for(d&=3;d--;)f[k]=a.charCodeAt(k),++k;return new Blob([f],
{type:c})}};"use strict";const RuntimeInterface$jscomp$1=self.RuntimeInterface;function IsCompatibilityMouseEvent(b){return b.sourceCapabilities&&b.sourceCapabilities.firesTouchEvents||b.originalEvent&&b.originalEvent.sourceCapabilities&&b.originalEvent.sourceCapabilities.firesTouchEvents}
const KEY_CODE_ALIASES=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),DISPATCH_RUNTIME_AND_SCRIPT={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},DISPATCH_SCRIPT_ONLY={dispatchUserScriptEvent:!0},DISPATCH_RUNTIME_ONLY={dispatchRuntimeEvent:!0};function AddStyleSheet(b){return new Promise((a,c)=>{const d=document.createElement("link");d.onload=()=>a(d);d.onerror=e=>c(e);d.rel="stylesheet";d.href=b;document.head.appendChild(d)})}
function FetchImage(b){return new Promise((a,c)=>{const d=new Image;d.onload=()=>a(d);d.onerror=e=>c(e);d.src=b})}async function BlobToImage(b){b=URL.createObjectURL(b);try{return await FetchImage(b)}finally{URL.revokeObjectURL(b)}}function BlobToString$jscomp$1(b){return new Promise((a,c)=>{let d=new FileReader;d.onload=e=>a(e.target.result);d.onerror=e=>c(e);d.readAsText(b)})}
async function BlobToSvgImage(b,a,c){if(!/firefox/i.test(navigator.userAgent))return await BlobToImage(b);var d=await BlobToString$jscomp$1(b);d=(new DOMParser).parseFromString(d,"image/svg+xml");const e=d.documentElement;if(e.hasAttribute("width")&&e.hasAttribute("height")){const f=e.getAttribute("width"),g=e.getAttribute("height");if(!f.includes("%")&&!g.includes("%"))return await BlobToImage(b)}e.setAttribute("width",a+"px");e.setAttribute("height",c+"px");d=(new XMLSerializer).serializeToString(d);
b=new Blob([d],{type:"image/svg+xml"});return await BlobToImage(b)}function IsInContentEditable(b){do{if(b.parentNode&&b.hasAttribute("contenteditable"))return!0;b=b.parentNode}while(b);return!1}const keyboardInputElementTagNames=new Set(["input","textarea","datalist","select"]);function IsKeyboardInputElement(b){return keyboardInputElementTagNames.has(b.tagName.toLowerCase())||IsInContentEditable(b)}const canvasOrDocTags=new Set(["canvas","body","html"]);
function PreventDefaultOnCanvasOrDoc(b){if(b.target.tagName){var a=b.target.tagName.toLowerCase();canvasOrDocTags.has(a)&&b.preventDefault()}}function BlockWheelZoom(b){(b.metaKey||b.ctrlKey)&&b.preventDefault()}
self.C3_GetSvgImageSize=async function(b){b=await BlobToImage(b);if(0<b.width&&0<b.height)return[b.width,b.height];b.style.position="absolute";b.style.left="0px";b.style.top="0px";b.style.visibility="hidden";document.body.appendChild(b);const a=b.getBoundingClientRect();document.body.removeChild(b);return[a.width,a.height]};
self.C3_RasterSvgImageBlob=async function(b,a,c,d,e){b=await BlobToSvgImage(b,a,c);const f=document.createElement("canvas");f.width=d;f.height=e;f.getContext("2d").drawImage(b,0,0,a,c);return f};let isCordovaPaused=!1;document.addEventListener("pause",()=>isCordovaPaused=!0);document.addEventListener("resume",()=>isCordovaPaused=!1);function ParentHasFocus(){try{return window.parent&&window.parent.document.hasFocus()}catch(b){return!1}}
function KeyboardIsVisible(){const b=document.activeElement;if(!b)return!1;const a=b.tagName.toLowerCase(),c=new Set("email number password search tel text url".split(" "));return"textarea"===a?!0:"input"===a?c.has(b.type.toLowerCase()||"text"):IsInContentEditable(b)}
RuntimeInterface$jscomp$1.AddDOMHandlerClass(class extends self.DOMHandler{constructor(b){super(b,"runtime");this._isFirstSizeUpdate=!0;this._enableWindowResizeEvent=!1;this._simulatedResizeTimerId=-1;this._targetOrientation="any";this._pageVisibilityIsHidden=this._attachedDeviceMotionEvent=this._attachedDeviceOrientationEvent=!1;this._screenReaderTextWrap=document.createElement("div");this._screenReaderTextWrap.className="c3-screen-reader-text";this._screenReaderTextWrap.setAttribute("aria-live",
"polite");document.body.appendChild(this._screenReaderTextWrap);this._debugHighlightElem=null;this._isExportToVideo=!1;this._exportVideoProgressMessage="";this._exportVideoUpdateTimerId=-1;this._enableAndroidVKDetection=!1;this._lastWindowWidth=b._GetWindowInnerWidth();this._lastWindowHeight=b._GetWindowInnerHeight();this._vkTranslateYOffset=this._virtualKeyboardHeight=0;b.AddRuntimeComponentMessageHandler("canvas","update-size",d=>this._OnUpdateCanvasSize(d));b.AddRuntimeComponentMessageHandler("runtime",
"invoke-download",d=>this._OnInvokeDownload(d));b.AddRuntimeComponentMessageHandler("runtime","load-webfonts",d=>this._OnLoadWebFonts(d));b.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",d=>this._OnRasterSvgImage(d));b.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",d=>this._OnGetSvgImageSize(d));b.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",d=>this._OnSetTargetOrientation(d));b.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>
this._OnRegisterSW());b.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",d=>this._OnPostToDebugger(d));b.AddRuntimeComponentMessageHandler("runtime","go-to-script",d=>this._OnPostToDebugger(d));b.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking());b.AddRuntimeComponentMessageHandler("runtime","debug-highlight",d=>this._OnDebugHighlight(d));b.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent());
b.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent());b.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",d=>this._OnAddStylesheet(d));b.AddRuntimeComponentMessageHandler("runtime","script-create-worker",d=>this._OnScriptCreateWorker(d));b.AddRuntimeComponentMessageHandler("runtime","alert",d=>this._OnAlert(d));b.AddRuntimeComponentMessageHandler("runtime","screen-reader-text",d=>this._OnScreenReaderTextEvent(d));b.AddRuntimeComponentMessageHandler("runtime",
"hide-cordova-splash",()=>this._OnHideCordovaSplash());b.AddRuntimeComponentMessageHandler("runtime","set-exporting-to-video",d=>this._SetExportingToVideo(d));b.AddRuntimeComponentMessageHandler("runtime","export-to-video-progress",d=>this._OnExportVideoProgress(d));b.AddRuntimeComponentMessageHandler("runtime","exported-to-video",d=>this._OnExportedToVideo(d));b.AddRuntimeComponentMessageHandler("runtime","exported-to-image-sequence",d=>this._OnExportedToImageSequence(d));const a=new Set(["input",
"textarea","datalist"]);window.addEventListener("contextmenu",d=>{const e=d.target,f=e.tagName.toLowerCase();a.has(f)||IsInContentEditable(e)||d.preventDefault()});const c=b.GetCanvas();window.addEventListener("selectstart",PreventDefaultOnCanvasOrDoc);window.addEventListener("gesturehold",PreventDefaultOnCanvasOrDoc);c.addEventListener("selectstart",PreventDefaultOnCanvasOrDoc);c.addEventListener("gesturehold",PreventDefaultOnCanvasOrDoc);window.addEventListener("touchstart",PreventDefaultOnCanvasOrDoc,
{passive:!1});"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",PreventDefaultOnCanvasOrDoc,{passive:!1}),c.addEventListener("pointerdown",PreventDefaultOnCanvasOrDoc)):c.addEventListener("touchstart",PreventDefaultOnCanvasOrDoc);this._mousePointerLastButtons=0;window.addEventListener("mousedown",d=>{1===d.button&&d.preventDefault()});window.addEventListener("mousewheel",BlockWheelZoom,{passive:!1});window.addEventListener("wheel",BlockWheelZoom,{passive:!1});window.addEventListener("resize",
()=>this._OnWindowResize());window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("fullscreenerror",d=>this._OnFullscreenError(d));window.addEventListener("webkitfullscreenerror",d=>this._OnFullscreenError(d));window.addEventListener("mozfullscreenerror",d=>this._OnFullscreenError(d));if(b.IsiOSWebView())if(window.visualViewport){let d=
Infinity;window.visualViewport.addEventListener("resize",()=>{const e=window.visualViewport.height;e>d&&(document.scrollingElement.scrollTop=0);d=e})}else window.addEventListener("focusout",()=>{KeyboardIsVisible()||(document.scrollingElement.scrollTop=0)});this._mediaPendingPlay=new Set;this._mediaRemovedPendingPlay=new WeakSet;this._isSilent=!1}_OnBeforeStartTicking(){self.setTimeout(()=>{this._enableAndroidVKDetection=!0},1E3);"cordova"===this._iRuntime.GetExportType()?(document.addEventListener("pause",
()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange("hidden"===document.visibilityState));this._pageVisibilityIsHidden=!("hidden"!==document.visibilityState&&!isCordovaPaused);return{isSuspended:this._pageVisibilityIsHidden}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus"));window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",
{parentHasFocus:ParentHasFocus()});this._mousePointerLastButtons=0});window.addEventListener("focusin",a=>{IsKeyboardInputElement(a.target)&&this._PostRuntimeEvent("keyboard-blur")});window.addEventListener("keydown",a=>this._OnKeyEvent("keydown",a));window.addEventListener("keyup",a=>this._OnKeyEvent("keyup",a));window.addEventListener("dblclick",a=>this._OnMouseEvent("dblclick",a,DISPATCH_RUNTIME_AND_SCRIPT));window.addEventListener("wheel",a=>this._OnMouseWheelEvent("wheel",a));"undefined"!==typeof PointerEvent?
(window.addEventListener("pointerdown",a=>{this._HandlePointerDownFocus(a);this._OnPointerEvent("pointerdown",a)}),this._iRuntime.UsesWorker()&&"undefined"!==typeof window.onpointerrawupdate&&self===self.top?window.addEventListener("pointerrawupdate",a=>this._OnPointerRawUpdate(a)):window.addEventListener("pointermove",a=>this._OnPointerEvent("pointermove",a)),window.addEventListener("pointerup",a=>this._OnPointerEvent("pointerup",a)),window.addEventListener("pointercancel",a=>this._OnPointerEvent("pointercancel",
a))):(window.addEventListener("mousedown",a=>{this._HandlePointerDownFocus(a);this._OnMouseEventAsPointer("pointerdown",a)}),window.addEventListener("mousemove",a=>this._OnMouseEventAsPointer("pointermove",a)),window.addEventListener("mouseup",a=>this._OnMouseEventAsPointer("pointerup",a)),window.addEventListener("touchstart",a=>{this._HandlePointerDownFocus(a);this._OnTouchEvent("pointerdown",a)}),window.addEventListener("touchmove",a=>this._OnTouchEvent("pointermove",a)),window.addEventListener("touchend",
a=>this._OnTouchEvent("pointerup",a)),window.addEventListener("touchcancel",a=>this._OnTouchEvent("pointercancel",a)));const b=()=>this._PlayPendingMedia();window.addEventListener("pointerup",b,!0);window.addEventListener("touchend",b,!0);window.addEventListener("click",b,!0);window.addEventListener("keydown",b,!0);window.addEventListener("gamepadconnected",b,!0);this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,
navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator.virtualKeyboard.boundingRect.height)}))}_OnAndroidVirtualKeyboardChange(b,a){document.body.style.transform="";this._vkTranslateYOffset=0;if(0<a){var c=document.activeElement;c&&(c=c.getBoundingClientRect(),b=(c.top+c.bottom)/2-(b-a)/2,b>a&&(b=a),0>b&&(b=0),0<b&&(document.body.style.transform=`translateY(${-b}px)`,this._vkTranslateYOffset=b))}}_PostRuntimeEvent(b,
a){this.PostToRuntime(b,a||null,DISPATCH_RUNTIME_ONLY)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_EnableWindowResizeEvent(){this._enableWindowResizeEvent=!0;this._lastWindowWidth=this._iRuntime._GetWindowInnerWidth();this._lastWindowHeight=this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){if(!this._isExportToVideo&&this._enableWindowResizeEvent){var b=this._GetWindowInnerWidth(),a=this._GetWindowInnerHeight();
if(this._iRuntime.IsAndroidWebView()){if(this._enableAndroidVKDetection){if(this._lastWindowWidth===b&&a<this._lastWindowHeight){this._virtualKeyboardHeight=this._lastWindowHeight-a;this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);return}0<this._virtualKeyboardHeight&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(a,this._virtualKeyboardHeight))}this._lastWindowWidth=b;this._lastWindowHeight=a}this.PostToRuntime("window-resize",{innerWidth:b,
innerHeight:a,devicePixelRatio:window.devicePixelRatio,isFullscreen:RuntimeInterface$jscomp$1.IsDocumentFullscreen()});this._iRuntime.IsiOSWebView()&&(-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(b,a,0))}}_ScheduleSimulatedResize(b,a,c){-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId);this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(b,a,c),48)}_OnSimulatedResize(b,a,c){const d=this._GetWindowInnerWidth(),
e=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1;d!=b||e!=a?this.PostToRuntime("window-resize",{innerWidth:d,innerHeight:e,devicePixelRatio:window.devicePixelRatio,isFullscreen:RuntimeInterface$jscomp$1.IsDocumentFullscreen()}):10>c&&this._ScheduleSimulatedResize(d,e,c+1)}_OnSetTargetOrientation(b){this._targetOrientation=b.targetOrientation}_TrySetTargetOrientation(){const b=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(b).catch(a=>console.warn("[Construct] Failed to lock orientation: ",
a));else try{let a=!1;screen.lockOrientation?a=screen.lockOrientation(b):screen.webkitLockOrientation?a=screen.webkitLockOrientation(b):screen.mozLockOrientation?a=screen.mozLockOrientation(b):screen.msLockOrientation&&(a=screen.msLockOrientation(b));a||console.warn("[Construct] Failed to lock orientation")}catch(a){console.warn("[Construct] Failed to lock orientation: ",a)}}_OnFullscreenChange(){if(!this._isExportToVideo){var b=RuntimeInterface$jscomp$1.IsDocumentFullscreen();b&&"any"!==this._targetOrientation&&
this._TrySetTargetOrientation();this.PostToRuntime("fullscreenchange",{isFullscreen:b,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}}_OnFullscreenError(b){console.warn("[Construct] Fullscreen request failed: ",b);this.PostToRuntime("fullscreenerror",{isFullscreen:RuntimeInterface$jscomp$1.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(b){this._pageVisibilityIsHidden!==b&&((this._pageVisibilityIsHidden=
b)?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame(),this.PostToRuntime("visibilitychange",{hidden:b}))}_OnKeyEvent(b,a){"Backspace"===a.key&&PreventDefaultOnCanvasOrDoc(a);if(!this._isExportToVideo){var c=KEY_CODE_ALIASES.get(a.code)||a.code;this._PostToRuntimeMaybeSync(b,{code:c,key:a.key,which:a.which,repeat:a.repeat,altKey:a.altKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey,shiftKey:a.shiftKey,timeStamp:a.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT)}}_OnMouseWheelEvent(b,a){this._isExportToVideo||
this.PostToRuntime(b,{clientX:a.clientX,clientY:a.clientY+this._vkTranslateYOffset,pageX:a.pageX,pageY:a.pageY+this._vkTranslateYOffset,deltaX:a.deltaX,deltaY:a.deltaY,deltaZ:a.deltaZ,deltaMode:a.deltaMode,timeStamp:a.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT)}_OnMouseEvent(b,a,c){this._isExportToVideo||IsCompatibilityMouseEvent(a)||this._PostToRuntimeMaybeSync(b,{button:a.button,buttons:a.buttons,clientX:a.clientX,clientY:a.clientY+this._vkTranslateYOffset,pageX:a.pageX,pageY:a.pageY+this._vkTranslateYOffset,
movementX:a.movementX||0,movementY:a.movementY||0,timeStamp:a.timeStamp},c)}_OnMouseEventAsPointer(b,a){if(!this._isExportToVideo&&!IsCompatibilityMouseEvent(a)){var c=this._mousePointerLastButtons;"pointerdown"===b&&0!==c?b="pointermove":"pointerup"===b&&0!==a.buttons&&(b="pointermove");this._PostToRuntimeMaybeSync(b,{pointerId:1,pointerType:"mouse",button:a.button,buttons:a.buttons,lastButtons:c,clientX:a.clientX,clientY:a.clientY+this._vkTranslateYOffset,pageX:a.pageX,pageY:a.pageY+this._vkTranslateYOffset,
movementX:a.movementX||0,movementY:a.movementY||0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,timeStamp:a.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT);this._mousePointerLastButtons=a.buttons;this._OnMouseEvent(a.type,a,DISPATCH_SCRIPT_ONLY)}}_OnPointerEvent(b,a){if(!this._isExportToVideo){var c=0;"mouse"===a.pointerType&&(c=this._mousePointerLastButtons);this._PostToRuntimeMaybeSync(b,{pointerId:a.pointerId,pointerType:a.pointerType,button:a.button,buttons:a.buttons,lastButtons:c,
clientX:a.clientX,clientY:a.clientY+this._vkTranslateYOffset,pageX:a.pageX,pageY:a.pageY+this._vkTranslateYOffset,movementX:a.movementX||0,movementY:a.movementY||0,width:a.width||0,height:a.height||0,pressure:a.pressure||0,tangentialPressure:a.tangentialPressure||0,tiltX:a.tiltX||0,tiltY:a.tiltY||0,twist:a.twist||0,timeStamp:a.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT);"mouse"===a.pointerType&&(c="mousemove","pointerdown"===b?c="mousedown":"pointerup"===b&&(c="mouseup"),this._OnMouseEvent(c,a,DISPATCH_SCRIPT_ONLY),
this._mousePointerLastButtons=a.buttons)}}_OnPointerRawUpdate(b){this._OnPointerEvent("pointermove",b)}_OnTouchEvent(b,a){if(!this._isExportToVideo)for(let c=0,d=a.changedTouches.length;c<d;++c){const e=a.changedTouches[c];this._PostToRuntimeMaybeSync(b,{pointerId:e.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:e.clientX,clientY:e.clientY+this._vkTranslateYOffset,pageX:e.pageX,pageY:e.pageY+this._vkTranslateYOffset,movementX:a.movementX||0,movementY:a.movementY||0,width:2*
(e.radiusX||e.webkitRadiusX||0),height:2*(e.radiusY||e.webkitRadiusY||0),pressure:e.force||e.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:e.rotationAngle||0,timeStamp:a.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT)}}_HandlePointerDownFocus(b){window!==window.top&&window.focus();this._IsElementCanvasOrDocument(b.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(b){return!b||b===document||b===window||
b===document.body||"canvas"===b.tagName.toLowerCase()}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",b=>this._OnDeviceOrientation(b)),window.addEventListener("deviceorientationabsolute",b=>this._OnDeviceOrientationAbsolute(b)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",b=>this._OnDeviceMotion(b)))}_OnDeviceOrientation(b){this._isExportToVideo||
this.PostToRuntime("deviceorientation",{absolute:!!b.absolute,alpha:b.alpha||0,beta:b.beta||0,gamma:b.gamma||0,timeStamp:b.timeStamp,webkitCompassHeading:b.webkitCompassHeading,webkitCompassAccuracy:b.webkitCompassAccuracy},DISPATCH_RUNTIME_AND_SCRIPT)}_OnDeviceOrientationAbsolute(b){this._isExportToVideo||this.PostToRuntime("deviceorientationabsolute",{absolute:!!b.absolute,alpha:b.alpha||0,beta:b.beta||0,gamma:b.gamma||0,timeStamp:b.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT)}_OnDeviceMotion(b){if(!this._isExportToVideo){var a=
null,c=b.acceleration;c&&(a={x:c.x||0,y:c.y||0,z:c.z||0});c=null;var d=b.accelerationIncludingGravity;d&&(c={x:d.x||0,y:d.y||0,z:d.z||0});d=null;var e=b.rotationRate;e&&(d={alpha:e.alpha||0,beta:e.beta||0,gamma:e.gamma||0});this.PostToRuntime("devicemotion",{acceleration:a,accelerationIncludingGravity:c,rotationRate:d,interval:b.interval,timeStamp:b.timeStamp},DISPATCH_RUNTIME_AND_SCRIPT)}}_OnUpdateCanvasSize(b){var a=this.GetRuntimeInterface();a.IsExportingToVideo()||(a=a.GetCanvas(),a.style.width=
b.styleWidth+"px",a.style.height=b.styleHeight+"px",a.style.marginLeft=b.marginLeft+"px",a.style.marginTop=b.marginTop+"px",document.documentElement.style.setProperty("--construct-scale",b.displayScale),this._isFirstSizeUpdate&&(a.style.display="",this._isFirstSizeUpdate=!1))}_OnInvokeDownload(b){const a=b.url;b=b.filename;const c=document.createElement("a"),d=document.body;c.textContent=b;c.href=a;c.download=b;d.appendChild(c);c.click();d.removeChild(c)}async _OnLoadWebFonts(b){await Promise.all(b.webfonts.map(async a=>
{a=new FontFace(a.name,`url('${a.url}')`);document.fonts.add(a);await a.load()}))}async _OnRasterSvgImage(b){var a=b.imageBitmapOpts;b=await self.C3_RasterSvgImageBlob(b.blob,b.imageWidth,b.imageHeight,b.surfaceWidth,b.surfaceHeight);a=a?await createImageBitmap(b,a):await createImageBitmap(b);return{imageBitmap:a,transferables:[a]}}async _OnGetSvgImageSize(b){return await self.C3_GetSvgImageSize(b.blob)}async _OnAddStylesheet(b){await AddStyleSheet(b.url)}_PlayPendingMedia(){var b=[...this._mediaPendingPlay];
this._mediaPendingPlay.clear();if(!this._isSilent)for(const a of b)(b=a.play())&&b.catch(c=>{this._mediaRemovedPendingPlay.has(a)||this._mediaPendingPlay.add(a)})}TryPlayMedia(b){if("function"!==typeof b.play)throw Error("missing play function");this._mediaRemovedPendingPlay.delete(b);let a;try{a=b.play()}catch(c){this._mediaPendingPlay.add(b);return}a&&a.catch(c=>{this._mediaRemovedPendingPlay.has(b)||this._mediaPendingPlay.add(b)})}RemovePendingPlay(b){this._mediaPendingPlay.delete(b);this._mediaRemovedPendingPlay.add(b)}SetSilent(b){this._isSilent=
!!b}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(b){if(b.show){this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));var a=this._debugHighlightElem;a.style.display="";a.style.left=b.left-1+"px";a.style.top=b.top-1+"px";a.style.width=b.width+2+"px";a.style.height=b.height+2+"px";a.textContent=b.name}else this._debugHighlightElem&&
(this._debugHighlightElem.style.display="none")}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(b){window.c3_postToMessagePort&&(b.from="runtime",window.c3_postToMessagePort(b))}_InvokeFunctionFromJS(b,a){return this.PostToRuntimeAsync("js-invoke-function",{name:b,params:a})}_OnScriptCreateWorker(b){const a=b.port2;(new Worker(b.url,b.opts)).postMessage({type:"construct-worker-init",port2:a},[a])}_OnAlert(b){alert(b.message)}_OnScreenReaderTextEvent(b){var a=b.type;
"create"===a?(a=document.createElement("p"),a.id="c3-sr-"+b.id,a.textContent=b.text,this._screenReaderTextWrap.appendChild(a)):"update"===a?(a=document.getElementById("c3-sr-"+b.id))?a.textContent=b.text:console.warn(`[Construct] Missing screen reader text with id ${b.id}`):"release"===a?(a=document.getElementById("c3-sr-"+b.id))?a.remove():console.warn(`[Construct] Missing screen reader text with id ${b.id}`):console.warn(`[Construct] Unknown screen reader text update '${a}'`)}_SetExportingToVideo(b){this._isExportToVideo=
!0;const a=document.createElement("h1");a.id="exportToVideoMessage";a.textContent=b.message;document.body.prepend(a);document.body.classList.add("exportingToVideo");this.GetRuntimeInterface().GetCanvas().style.display="";this._iRuntime.SetIsExportingToVideo(b.duration)}_OnExportVideoProgress(b){this._exportVideoProgressMessage=b.message;-1===this._exportVideoUpdateTimerId&&(this._exportVideoUpdateTimerId=setTimeout(()=>this._DoUpdateExportVideoProgressMessage(),250))}_DoUpdateExportVideoProgressMessage(){this._exportVideoUpdateTimerId=
-1;const b=document.getElementById("exportToVideoMessage");b&&(b.textContent=this._exportVideoProgressMessage)}_OnExportedToVideo(b){window.c3_postToMessagePort({type:"exported-video",arrayBuffer:b.arrayBuffer,contentType:b.contentType,time:b.time})}_OnExportedToImageSequence(b){window.c3_postToMessagePort({type:"exported-image-sequence",blobArr:b.blobArr,time:b.time,gif:b.gif})}});"use strict";
self.JobSchedulerDOM=class{constructor(b){this._runtimeInterface=b;this._baseUrl=b.GetRuntimeBaseURL();"preview"===b.GetExportType()?this._baseUrl+="workers/":this._baseUrl+=b.GetScriptFolder();this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16);this._dispatchWorker=null;this._jobWorkers=[];this._outputPort=this._inputPort=null}_GetWorkerScriptFolder(){return"playable-ad"===this._runtimeInterface.GetExportType()?this._runtimeInterface.GetScriptFolder():""}async Init(){if(this._hasInitialised)throw Error("already initialised");
this._hasInitialised=!0;var b=this._runtimeInterface._GetWorkerURL(this._GetWorkerScriptFolder()+"dispatchworker.js");this._dispatchWorker=await this._runtimeInterface.CreateWorker(b,this._baseUrl,{name:"DispatchWorker"});b=new MessageChannel;this._inputPort=b.port1;this._dispatchWorker.postMessage({type:"_init","in-port":b.port2},[b.port2]);this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const b=this._jobWorkers.length;var a=this._runtimeInterface._GetWorkerURL(this._GetWorkerScriptFolder()+
"jobworker.js");a=await this._runtimeInterface.CreateWorker(a,this._baseUrl,{name:"JobWorker"+b});const c=new MessageChannel,d=new MessageChannel;this._dispatchWorker.postMessage({type:"_addJobWorker",port:c.port1},[c.port1]);a.postMessage({type:"init",number:b,"dispatch-port":c.port2,"output-port":d.port2},[c.port2,d.port2]);this._jobWorkers.push(a);return d.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,
this._outputPort]}};"use strict";window.C3_IsSupported&&(window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:!1,workerMainUrl:"workermain.js",engineScripts:["scripts/c3runtime.js"],projectScripts:[],mainProjectScript:"",scriptFolder:"scripts/",workerDependencyScripts:[],exportType:"html5"}));"use strict";function elemsForSelector(b,a){return b?a?Array.from(document.querySelectorAll(b)):(b=document.querySelector(b))?[b]:[]:[document.documentElement]}function noop(){}
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(b){super(b,"browser");this._exportType="";this.AddRuntimeMessageHandlers([["get-initial-state",a=>this._OnGetInitialState(a)],["ready-for-sw-messages",()=>this._OnReadyForSWMessages()],["alert",a=>this._OnAlert(a)],["close",()=>this._OnClose()],["set-focus",a=>this._OnSetFocus(a)],["vibrate",a=>this._OnVibrate(a)],["lock-orientation",a=>this._OnLockOrientation(a)],["unlock-orientation",()=>this._OnUnlockOrientation()],
["navigate",a=>this._OnNavigate(a)],["request-fullscreen",a=>this._OnRequestFullscreen(a)],["exit-fullscreen",()=>this._OnExitFullscreen()],["set-hash",a=>this._OnSetHash(a)],["set-document-css-style",a=>this._OnSetDocumentCSSStyle(a)],["get-document-css-style",a=>this._OnGetDocumentCSSStyle(a)]]);window.addEventListener("online",()=>this._OnOnlineStateChanged(!0));window.addEventListener("offline",()=>this._OnOnlineStateChanged(!1));window.addEventListener("hashchange",()=>this._OnHashChange());
document.addEventListener("backbutton",()=>this._OnCordovaBackButton())}_OnGetInitialState(b){this._exportType=b.exportType;return{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isConstructArcade:"undefined"!==typeof window.is_scirra_arcade}}_OnReadyForSWMessages(){window.C3_RegisterSW&&
window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(b=>this.PostToRuntime("sw-message",b.data))}_OnOnlineStateChanged(b){this.PostToRuntime("online-state",{isOnline:b})}_OnCordovaBackButton(){this.PostToRuntime("backbutton")}GetNWjsWindow(){return"nwjs"===this._exportType?nw.Window.get():null}_OnAlert(b){alert(b.message)}_OnClose(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}_OnSetFocus(b){b=
b.isFocus;if("nwjs"===this._exportType){const a=this.GetNWjsWindow();b?a.focus():a.blur()}else b?window.focus():window.blur()}_OnVibrate(b){navigator.vibrate&&navigator.vibrate(b.pattern)}_OnLockOrientation(b){b=b.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(b).catch(a=>console.warn("[Construct] Failed to lock orientation: ",a));else try{let a=!1;screen.lockOrientation?a=screen.lockOrientation(b):screen.webkitLockOrientation?a=screen.webkitLockOrientation(b):
screen.mozLockOrientation?a=screen.mozLockOrientation(b):screen.msLockOrientation&&(a=screen.msLockOrientation(b));a||console.warn("[Construct] Failed to lock orientation")}catch(a){console.warn("[Construct] Failed to lock orientation: ",a)}}_OnUnlockOrientation(){try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():
screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(b){}}_OnNavigate(b){var a=b.type;if("back"===a)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.history.back();else if("forward"===a)window.history.forward();else if("reload"===a)location.reload();else if("url"===a){a=b.url;const c=b.target;b=b.exportType;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(a,"_system"):"preview"===b||this._iRuntime.IsWebView2Wrapper()?window.open(a,"_blank"):
this._isConstructArcade||(2===c?window.top.location=a:1===c?window.parent.location=a:window.location=a)}else"new-window"===a&&(a=b.url,b=b.tag,self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(a,"_system"):window.open(a,b))}_OnRequestFullscreen(b){if(this._iRuntime.IsWebView2Wrapper()||"macos-wkwebview"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!0),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!0});else{const a={navigationUI:"auto"};
b=b.navUI;1===b?a.navigationUI="hide":2===b&&(a.navigationUI="show");b=document.documentElement;let c;b.requestFullscreen?c=b.requestFullscreen(a):b.mozRequestFullScreen?c=b.mozRequestFullScreen(a):b.msRequestFullscreen?c=b.msRequestFullscreen(a):b.webkitRequestFullScreen&&(c="undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?b.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):b.webkitRequestFullScreen());c instanceof Promise&&c.catch(noop)}}_OnExitFullscreen(){if(this._iRuntime.IsWebView2Wrapper()||
"macos-wkwebview"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!1),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!1});else{let b;document.exitFullscreen?b=document.exitFullscreen():document.mozCancelFullScreen?b=document.mozCancelFullScreen():document.msExitFullscreen?b=document.msExitFullscreen():document.webkitCancelFullScreen&&(b=document.webkitCancelFullScreen());b instanceof Promise&&b.catch(noop)}}_OnSetHash(b){location.hash=b.hash}_OnHashChange(){this.PostToRuntime("hashchange",
{location:location.toString()})}_OnSetDocumentCSSStyle(b){const a=b.prop,c=b.value,d=b.selector;b=b["is-all"];try{const e=elemsForSelector(d,b);for(const f of e)a.startsWith("--")?f.style.setProperty(a,c):f.style[a]=c}catch(e){console.warn("[Browser] Failed to set style: ",e)}}_OnGetDocumentCSSStyle(b){const a=b.prop;b=b.selector;try{const c=document.querySelector(b);return c?{isOk:!0,result:window.getComputedStyle(c).getPropertyValue(a)}:{isOk:!1}}catch(c){return console.warn("[Browser] Failed to get style: ",
c),{isOk:!1}}}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(b){super(b,"mouse");this.AddRuntimeMessageHandlers([["cursor",a=>this._OnChangeCursorStyle(a)],["request-pointer-lock",()=>this._OnRequestPointerLock()],["release-pointer-lock",()=>this._OnReleasePointerLock()]]);document.addEventListener("pointerlockchange",a=>this._OnPointerLockChange());document.addEventListener("pointerlockerror",a=>this._OnPointerLockError())}_OnChangeCursorStyle(b){document.documentElement.style.cursor=b}_OnRequestPointerLock(){this._iRuntime.GetCanvas().requestPointerLock()}_OnReleasePointerLock(){document.exitPointerLock()}_OnPointerLockChange(){this.PostToRuntime("pointer-lock-change",
{"has-pointer-lock":!!document.pointerLockElement})}_OnPointerLockError(){this.PostToRuntime("pointer-lock-error",{"has-pointer-lock":!!document.pointerLockElement})}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(b){super(b,"touch");this.AddRuntimeMessageHandler("request-permission",a=>this._OnRequestPermission(a))}async _OnRequestPermission(b){b=b.type;let a=!0;0===b?a=await this._RequestOrientationPermission():1===b&&(a=await this._RequestMotionPermission());this.PostToRuntime("permission-result",{type:b,result:a})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;
try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(b){return console.warn("[Touch] Failed to request orientation permission: ",b),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(b){return console.warn("[Touch] Failed to request motion permission: ",b),!1}}});"use strict";const R_TO_D=180/Math.PI;
self.AudioDOMHandler=class extends self.DOMHandler{constructor(b){super(b,"audio");this._destinationNode=this._audioContext=null;this._hasAttachedUnblockEvents=this._hasUnblocked=!1;this._unblockFunc=()=>this._UnblockAudioContext();this._audioBuffers=[];this._audioInstances=[];this._lastAudioInstance=null;this._lastPlayedTags=[];this._loadedAudioUrls=new Set;this._lastTickCount=-1;this._pendingTags=new Map;this._masterVolume=1;this._isSilent=!1;this._timeScaleMode=0;this._timeScale=1;this._gameTime=
0;this._panningModel="HRTF";this._distanceModel="inverse";this._refDistance=600;this._maxDistance=1E4;this._rolloffFactor=1;this._lastListenerPos=[0,0,0];this._lastListenerOrientation=[0,0,-1,0,1,0];this._hasAnySoftwareDecodedMusic=this._playMusicAsSound=!1;this._supportsWebMOpus=this._iRuntime.IsAudioFormatSupported("audio/webm; codecs=opus");this._effects=new Map;this._analysers=new Set;this._hasStartedOfflineRender=this._isPendingPostFxState=!1;this._microphoneTag="";this._microphoneSource=null;
self.C3Audio_OnMicrophoneStream=(a,c)=>this._OnMicrophoneStream(a,c);this._destMediaStreamNode=null;self.C3Audio_GetOutputStream=()=>this._OnGetOutputStream();self.C3Audio_DOMInterface=this;this.AddRuntimeMessageHandlers([["create-audio-context",a=>this._CreateAudioContext(a)],["play",a=>this._Play(a)],["stop",a=>this._Stop(a)],["stop-all",()=>this._StopAll()],["set-paused",a=>this._SetPaused(a)],["set-volume",a=>this._SetVolume(a)],["fade-volume",a=>this._FadeVolume(a)],["set-master-volume",a=>this._SetMasterVolume(a)],
["set-muted",a=>this._SetMuted(a)],["set-silent",a=>this._SetSilent(a)],["set-looping",a=>this._SetLooping(a)],["set-playback-rate",a=>this._SetPlaybackRate(a)],["set-stereo-pan",a=>this._SetStereoPan(a)],["seek",a=>this._Seek(a)],["preload",a=>this._Preload(a)],["unload",a=>this._Unload(a)],["unload-all",()=>this._UnloadAll()],["set-suspended",a=>this._SetSuspended(a)],["add-effect",a=>this._AddEffect(a)],["set-effect-param",a=>this._SetEffectParam(a)],["remove-effects",a=>this._RemoveEffects(a)],
["tick",a=>this._OnTick(a)],["load-state",a=>this._OnLoadState(a)],["offline-render-audio",a=>this._OnOfflineRenderAudio(a)],["offline-render-finish",()=>this._OnOfflineRenderFinish()]])}async _CreateAudioContext(b){if(b.isiOSCordova||b.isSafari)this._playMusicAsSound=!0;this._timeScaleMode=b.timeScaleMode;this._panningModel=["equalpower","HRTF","soundfield"][b.panningModel];this._distanceModel=["linear","inverse","exponential"][b.distanceModel];this._refDistance=b.refDistance;this._maxDistance=b.maxDistance;
this._rolloffFactor=b.rolloffFactor;if(this._iRuntime.IsExportingToVideo())this._playMusicAsSound=!0,this._audioContext=new OfflineAudioContext({numberOfChannels:2,sampleRate:48E3,length:Math.ceil(48E3*this._iRuntime.GetExportToVideoDuration())});else{var a={latencyHint:b.latencyHint};this.SupportsWebMOpus()||(a.sampleRate=48E3);if("undefined"!==typeof AudioContext)this._audioContext=new AudioContext(a);else if("undefined"!==typeof webkitAudioContext)this._audioContext=new webkitAudioContext(a);else throw Error("Web Audio API not supported");
this._AttachUnblockEvents();this._audioContext.onstatechange=()=>{"running"!==this._audioContext.state&&this._AttachUnblockEvents();this.PostToRuntime("audiocontext-state",{audioContextState:this._audioContext.state})}}this._destinationNode=this._audioContext.createGain();this._destinationNode.connect(this._audioContext.destination);a=b.listenerPos;this._lastListenerPos[0]=a[0];this._lastListenerPos[1]=a[1];this._lastListenerPos[2]=a[2];this._audioContext.listener.setPosition(a[0],a[1],a[2]);this._audioContext.listener.setOrientation(...this._lastListenerOrientation);
self.C3_GetAudioContextCurrentTime=()=>this.GetAudioCurrentTime();try{await Promise.all(b.preloadList.map(c=>this._GetAudioBuffer(c.originalUrl,c.url,c.type,!1)))}catch(c){console.error("[Construct] Preloading sounds failed: ",c)}return{sampleRate:this._audioContext.sampleRate,audioContextState:this._audioContext.state,outputLatency:this._audioContext.outputLatency||0}}_AttachUnblockEvents(){this._hasAttachedUnblockEvents||(this._hasUnblocked=!1,window.addEventListener("pointerup",this._unblockFunc,
!0),window.addEventListener("touchend",this._unblockFunc,!0),window.addEventListener("click",this._unblockFunc,!0),window.addEventListener("keydown",this._unblockFunc,!0),this._hasAttachedUnblockEvents=!0)}_DetachUnblockEvents(){this._hasAttachedUnblockEvents&&(this._hasUnblocked=!0,window.removeEventListener("pointerup",this._unblockFunc,!0),window.removeEventListener("touchend",this._unblockFunc,!0),window.removeEventListener("click",this._unblockFunc,!0),window.removeEventListener("keydown",this._unblockFunc,
!0),this._hasAttachedUnblockEvents=!1)}_UnblockAudioContext(){if(!this._hasUnblocked){var b=this._audioContext;"suspended"===b.state&&b.resume&&b.resume();var a=b.createBuffer(1,220,22050),c=b.createBufferSource();c.buffer=a;c.connect(b.destination);c.start(0);"running"===b.state&&this._DetachUnblockEvents()}}_MatchTagLists(b,a){for(const c of a){a=!1;for(const d of b)if(self.AudioDOMHandler.EqualsNoCase(d,c)){a=!0;break}if(!a)return!1}return!0}GetAudioContext(){return this._audioContext}GetAudioCurrentTime(){return this._audioContext.currentTime}GetDestinationNode(){return this._destinationNode}GetAudioContextExtern(){return this.GetAudioContext()}GetDestinationNodeExtern(){return this.GetDestinationNode()}GetDestinationForTag(b){return(b=
this._effects.get(b.toLowerCase()))?b[0].GetInputNode():this.GetDestinationNode()}AddEffectForTag(b,a){b=b.toLowerCase();let c=this._effects.get(b);c||(c=[],this._effects.set(b,c));a._SetIndex(c.length);a._SetTag(b);c.push(a);this._ReconnectEffects(b)}_ReconnectEffects(b){b=b.toLowerCase();let a=this.GetDestinationNode();const c=this._effects.get(b);if(c&&c.length){a=c[0].GetInputNode();for(let d=0,e=c.length;d<e;++d){const f=c[d];d+1===e?f.ConnectTo(this.GetDestinationNode()):f.ConnectTo(c[d+1].GetInputNode())}}for(const d of this.audioInstancesByEffectTag(b))d.Reconnect(a);
this._microphoneSource&&this._microphoneTag===b&&(this._microphoneSource.disconnect(),this._microphoneSource.connect(a))}GetMasterVolume(){return this._masterVolume}IsSilent(){return this._isSilent}GetTimeScaleMode(){return this._timeScaleMode}GetTimeScale(){return this._timeScale}GetGameTime(){return this._gameTime}IsPlayMusicAsSound(){return this._playMusicAsSound}SupportsWebMOpus(){return this._supportsWebMOpus}_SetHasAnySoftwareDecodedMusic(){this._hasAnySoftwareDecodedMusic=!0}GetPanningModel(){return this._panningModel}GetDistanceModel(){return this._distanceModel}GetReferenceDistance(){return this._refDistance}GetMaxDistance(){return this._maxDistance}GetRolloffFactor(){return this._rolloffFactor}DecodeAudioData(b,
a){return a?this._iRuntime._WasmDecodeWebMOpus(b).then(c=>{const d=this._audioContext.createBuffer(1,c.length,48E3);d.getChannelData(0).set(c);return d}):new Promise((c,d)=>{this._audioContext.decodeAudioData(b,c,d)})}TryPlayMedia(b){this._iRuntime.TryPlayMedia(b)}RemovePendingPlay(b){this._iRuntime.RemovePendingPlay(b)}ReleaseInstancesForBuffer(b){let a=0;for(let c=0,d=this._audioInstances.length;c<d;++c){const e=this._audioInstances[c];this._audioInstances[a]=e;e.GetBuffer()===b?e.Release():++a}this._audioInstances.length=
a}ReleaseAllMusicBuffers(){let b=0;for(let a=0,c=this._audioBuffers.length;a<c;++a){const d=this._audioBuffers[a];this._audioBuffers[b]=d;d.IsMusic()?d.Release():++b}this._audioBuffers.length=b}*audioInstancesMatchingTags(b){if(0<b.length)for(const a of this._audioInstances)this._MatchTagLists(a.GetTags(),b)&&(yield a);else this._lastAudioInstance&&!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}*audioInstancesByEffectTag(b){if(b)for(const a of this._audioInstances)self.AudioDOMHandler.EqualsNoCase(a.GetEffectTag(),
b)&&(yield a);else this._lastAudioInstance&&!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}async _GetAudioBuffer(b,a,c,d,e){for(const f of this._audioBuffers)if(f.GetUrl()===a)return await f.Load(),f;if(e)return null;d&&(this._playMusicAsSound||this._hasAnySoftwareDecodedMusic)&&this.ReleaseAllMusicBuffers();a=self.C3AudioBuffer.Create(this,b,a,c,d);this._audioBuffers.push(a);await a.Load();this._loadedAudioUrls.has(b)||(this.PostToRuntime("buffer-metadata",{originalUrl:b,duration:a.GetDuration()}),
this._loadedAudioUrls.add(b));return a}async _GetAudioInstance(b,a,c,d,e){for(const f of this._audioInstances)if(f.GetUrl()===a&&(f.CanBeRecycled()||e))return f.SetTags(d),f;b=(await this._GetAudioBuffer(b,a,c,e)).CreateInstance(d);this._audioInstances.push(b);return b}_AddPendingTags(b){b=b.join(" ");let a=this._pendingTags.get(b);if(!a){let c=null;a={pendingCount:0,promise:new Promise(d=>c=d),resolve:c};this._pendingTags.set(b,a)}a.pendingCount++}_RemovePendingTags(b){b=b.join(" ");const a=this._pendingTags.get(b);
if(!a)throw Error("expected pending tag");a.pendingCount--;0===a.pendingCount&&(a.resolve(),this._pendingTags.delete(b))}TagsReady(b){b=(0===b.length?this._lastPlayedTags:b).join(" ");return(b=this._pendingTags.get(b))?b.promise:Promise.resolve()}_MaybeStartTicking(){if(0<this._analysers.size)this._StartTicking();else for(const b of this._audioInstances)if(b.IsActive()){this._StartTicking();break}}Tick(){for(var b of this._analysers)b.Tick();b=this.GetAudioCurrentTime();for(var a of this._audioInstances)a.Tick(b);
a=this._audioInstances.filter(c=>c.IsActive()).map(c=>c.GetState());this.PostToRuntime("state",{tickCount:this._lastTickCount,outputLatency:this._audioContext.outputLatency||0,audioInstances:a,analysers:[...this._analysers].map(c=>c.GetData())});0===a.length&&0===this._analysers.size&&this._StopTicking()}PostTrigger(b,a,c){this.PostToRuntime("trigger",{type:b,tags:a,aiid:c})}async _Play(b){const a=b.originalUrl,c=b.url,d=b.type,e=b.isMusic,f=b.tags,g=b.isLooping,h=b.vol,k=b.pos,l=b.panning,m=b.stereoPan;
let n=b.off;0<n&&!b.trueClock&&(this._audioContext.getOutputTimestamp?(b=this._audioContext.getOutputTimestamp(),n=n-b.performanceTime/1E3+b.contextTime):n=n-performance.now()/1E3+this._audioContext.currentTime);this._lastPlayedTags=f.slice(0);this._AddPendingTags(f);try{this._lastAudioInstance=await this._GetAudioInstance(a,c,d,f,e),l?(this._lastAudioInstance.SetPannerEnabled(!0),this._lastAudioInstance.SetPan(l.x,l.y,l.z,l.angle,l.innerAngle,l.outerAngle,l.outerGain),l.hasOwnProperty("uid")&&this._lastAudioInstance.SetUID(l.uid)):
"number"===typeof m&&0!==m?(this._lastAudioInstance.SetStereoPannerEnabled(!0),this._lastAudioInstance.SetStereoPan(m)):(this._lastAudioInstance.SetPannerEnabled(!1),this._lastAudioInstance.SetStereoPannerEnabled(!1)),this._lastAudioInstance.Play(g,h,k,n)}catch(p){console.error("[Construct] Audio: error starting playback: ",p);return}finally{this._RemovePendingTags(f)}this._StartTicking()}_Stop(b){b=b.tags;for(const a of this.audioInstancesMatchingTags(b))a.Stop()}_StopAll(){for(const b of this._audioInstances)b.Stop()}_SetPaused(b){const a=
b.tags;b=b.paused;for(const c of this.audioInstancesMatchingTags(a))b?c.Pause():c.Resume();this._MaybeStartTicking()}_SetVolume(b){const a=b.tags;b=b.vol;for(const c of this.audioInstancesMatchingTags(a))c.SetVolume(b)}_SetStereoPan(b){const a=b.tags;b=b.p;for(const c of this.audioInstancesMatchingTags(a))c.SetStereoPannerEnabled(!0),c.SetStereoPan(b)}async _FadeVolume(b){const a=b.tags,c=b.vol,d=b.duration;b=b.stopOnEnd;await this.TagsReady(a);for(const e of this.audioInstancesMatchingTags(a))e.FadeVolume(c,
d,b);this._MaybeStartTicking()}_SetMasterVolume(b){this._masterVolume=b.vol;this._destinationNode.gain.value=this._masterVolume}_SetMuted(b){const a=b.tags;b=b.isMuted;for(const c of this.audioInstancesMatchingTags(a))c.SetMuted(b)}_SetSilent(b){this._isSilent=b.isSilent;this._iRuntime.SetSilent(this._isSilent);for(const a of this._audioInstances)a._UpdateMuted()}_SetLooping(b){const a=b.tags;b=b.isLooping;for(const c of this.audioInstancesMatchingTags(a))c.SetLooping(b)}async _SetPlaybackRate(b){const a=
b.tags;b=b.rate;await this.TagsReady(a);for(const c of this.audioInstancesMatchingTags(a))c.SetPlaybackRate(b)}async _Seek(b){const a=b.tags;b=b.pos;await this.TagsReady(a);for(const c of this.audioInstancesMatchingTags(a))c.Seek(b)}async _Preload(b){const a=b.originalUrl,c=b.url,d=b.type;b=b.isMusic;try{await this._GetAudioInstance(a,c,d,"",b)}catch(e){console.error("[Construct] Audio: error preloading: ",e)}}async _Unload(b){if(b=await this._GetAudioBuffer("",b.url,b.type,b.isMusic,!0))b.Release(),
b=this._audioBuffers.indexOf(b),-1!==b&&this._audioBuffers.splice(b,1)}_UnloadAll(){for(const b of this._audioBuffers)b.Release();this._audioBuffers.length=0}_SetSuspended(b){b=b.isSuspended;!b&&this._audioContext.resume&&this._audioContext.resume();for(const a of this._audioInstances)a.SetSuspended(b);b&&this._audioContext.suspend&&this._audioContext.suspend()}_OnTick(b){this._timeScale=b.timeScale;this._gameTime=b.gameTime;this._lastTickCount=b.tickCount;if(0!==this._timeScaleMode)for(var a of this._audioInstances)a._UpdatePlaybackRate();
!(a=b.listenerPos)||this._lastListenerPos[0]===a[0]&&this._lastListenerPos[1]===a[1]&&this._lastListenerPos[2]===a[2]||(this._lastListenerPos[0]=a[0],this._lastListenerPos[1]=a[1],this._lastListenerPos[2]=a[2],this._audioContext.listener.setPosition(a[0],a[1],a[2]));if((a=b.listenerOrientation)&&(this._lastListenerOrientation[0]!==a[0]||this._lastListenerOrientation[1]!==a[1]||this._lastListenerOrientation[2]!==a[2]||this._lastListenerOrientation[3]!==a[3]||this._lastListenerOrientation[4]!==a[4]||
this._lastListenerOrientation[5]!==a[5])){for(let c=0;6>c;++c)this._lastListenerOrientation[c]=a[c];this._audioContext.listener.setOrientation(...this._lastListenerOrientation)}for(const c of b.instPans){b=c.uid;for(const d of this._audioInstances)d.GetUID()===b&&d.SetPanXYZA(c.x,c.y,c.z,c.angle)}}async _AddEffect(b){const a=b.type;var c=b.tags;const d=b.params;let e;if("convolution"===a)try{e=await this._GetAudioBuffer(b.bufferOriginalUrl,b.bufferUrl,b.bufferType,!1)}catch(f){console.log("[Construct] Audio: error loading convolution: ",
f);return}for(const f of c){if("filter"===a)c=new self.C3AudioFilterFX(this,...d);else if("delay"===a)c=new self.C3AudioDelayFX(this,...d);else if("convolution"===a)c=new self.C3AudioConvolveFX(this,e.GetAudioBuffer(),...d),c._SetBufferInfo(b.bufferOriginalUrl,b.bufferUrl,b.bufferType);else if("flanger"===a)c=new self.C3AudioFlangerFX(this,...d);else if("phaser"===a)c=new self.C3AudioPhaserFX(this,...d);else if("gain"===a)c=new self.C3AudioGainFX(this,...d);else if("stereopan"===a)c=new self.C3AudioStereoPanFX(this,
...d);else if("tremolo"===a)c=new self.C3AudioTremoloFX(this,...d);else if("ringmod"===a)c=new self.C3AudioRingModFX(this,...d);else if("distortion"===a)c=new self.C3AudioDistortionFX(this,...d);else if("compressor"===a)c=new self.C3AudioCompressorFX(this,...d);else if("analyser"===a)c=new self.C3AudioAnalyserFX(this,...d);else throw Error("invalid effect type");this.AddEffectForTag(f,c)}this._PostUpdatedFxState()}_SetEffectParam(b){var a=b.tags;const c=b.index,d=b.param,e=b.value,f=b.ramp;b=b.time;
for(const g of a)a=this._effects.get(g.toLowerCase()),!a||0>c||c>=a.length||a[c].SetParam(d,e,f,b);this._PostUpdatedFxState()}_RemoveEffects(b){b=b.tags;for(const a of b){b=a.toLowerCase();const c=this._effects.get(b);if(!c||!c.length)break;for(const d of c)d.Release();this._effects.delete(b);this._ReconnectEffects(b)}}_AddAnalyser(b){this._analysers.add(b);this._MaybeStartTicking()}_RemoveAnalyser(b){this._analysers.delete(b)}_PostUpdatedFxState(){this._isPendingPostFxState||(this._isPendingPostFxState=
!0,Promise.resolve().then(()=>this._DoPostUpdatedFxState()))}_DoPostUpdatedFxState(){const b={};for(const [a,c]of this._effects)b[a]=c.map(d=>d.GetState());this.PostToRuntime("fxstate",{fxstate:b});this._isPendingPostFxState=!1}async _OnLoadState(b){const a=b.saveLoadMode;if(3!==a){var c=[];for(var d of this._audioInstances)d.IsMusic()&&1===a||!d.IsMusic()&&2===a?c.push(d):d.Release();this._audioInstances=c}for(const e of this._effects.values())for(const f of e)f.Release();this._effects.clear();this._timeScale=
b.timeScale;this._gameTime=b.gameTime;c=b.listenerPos;this._lastListenerPos[0]=c[0];this._lastListenerPos[1]=c[1];this._lastListenerPos[2]=c[2];this._audioContext.listener.setPosition(c[0],c[1],c[2]);c=b.listenerOrientation;if(Array.isArray(c)){for(d=0;6>d;++d)this._lastListenerOrientation[d]=c[d];this._audioContext.listener.setOrientation(...this._lastListenerOrientation)}this._isSilent=b.isSilent;this._iRuntime.SetSilent(this._isSilent);this._masterVolume=b.masterVolume;this._destinationNode.gain.value=
this._masterVolume;c=[];for(const e of Object.values(b.effects))c.push(Promise.all(e.map(f=>this._AddEffect(f))));await Promise.all(c);await Promise.all(b.playing.map(e=>this._LoadAudioInstance(e,a)));this._MaybeStartTicking()}async _LoadAudioInstance(b,a){if(3!==a){var c=b.bufferOriginalUrl,d=b.bufferUrl,e=b.bufferType,f=b.isMusic,g=b.tags,h=b.isLooping,k=b.volume,l=b.playbackTime;if(!f||1!==a)if(f||2!==a){a=null;try{a=await this._GetAudioInstance(c,d,e,g,f)}catch(m){console.error("[Construct] Audio: error loading audio state: ",
m);return}a.LoadPanState(b.pan);a.LoadStereoPanState(b.stereoPan);a.Play(h,k,l,0);b.isPlaying||a.Pause();a._LoadAdditionalState(b)}}}_OnMicrophoneStream(b,a){this._microphoneSource&&this._microphoneSource.disconnect();this._microphoneTag=a.toLowerCase();this._microphoneSource=this._audioContext.createMediaStreamSource(b);this._microphoneSource.connect(this.GetDestinationForTag(this._microphoneTag))}_OnGetOutputStream(){this._destMediaStreamNode||(this._destMediaStreamNode=this._audioContext.createMediaStreamDestination(),
this._destinationNode.connect(this._destMediaStreamNode));return this._destMediaStreamNode.stream}async _OnOfflineRenderAudio(b){try{const a=this._audioContext.suspend(b.time);this._hasStartedOfflineRender?this._audioContext.resume():(this._audioContext.startRendering().then(c=>this._OnOfflineRenderCompleted(c)).catch(c=>this._OnOfflineRenderError(c)),this._hasStartedOfflineRender=!0);await a}catch(a){this._OnOfflineRenderError(a)}}_OnOfflineRenderFinish(){this._audioContext.resume()}_OnOfflineRenderCompleted(b){const a=
[];for(let c=0,d=b.numberOfChannels;c<d;++c){const e=b.getChannelData(c);a.push(e.buffer)}this._iRuntime.PostToRuntimeComponent("runtime","offline-audio-render-completed",{duration:b.duration,length:b.length,numberOfChannels:b.numberOfChannels,sampleRate:b.sampleRate,channelData:a},null,a)}_OnOfflineRenderError(b){console.error("[Audio] Offline rendering error: ",b)}static EqualsNoCase(b,a){return b===a||b.normalize().toLowerCase()===a.normalize().toLowerCase()}static ToDegrees(b){return b*R_TO_D}static DbToLinearNoCap(b){return Math.pow(10,
b/20)}static DbToLinear(b){return Math.max(Math.min(self.AudioDOMHandler.DbToLinearNoCap(b),1),0)}static LinearToDbNoCap(b){return Math.log(b)/Math.log(10)*20}static LinearToDb(b){return self.AudioDOMHandler.LinearToDbNoCap(Math.max(Math.min(b,1),0))}static e4(b,a){return 1-Math.exp(-a*b)}};self.RuntimeInterface.AddDOMHandlerClass(self.AudioDOMHandler);"use strict";
self.C3AudioBuffer=class{constructor(b,a,c,d,e){this._audioDomHandler=b;this._originalUrl=a;this._url=c;this._type=d;this._isMusic=e;this._api="";this._loadState="not-loaded";this._loadPromise=null}Release(){this._loadState="not-loaded";this._loadPromise=this._audioDomHandler=null}static Create(b,a,c,d,e){const f="audio/webm; codecs=opus"===d&&!b.SupportsWebMOpus();e&&f&&b._SetHasAnySoftwareDecodedMusic();return!e||b.IsPlayMusicAsSound()||f?new self.C3WebAudioBuffer(b,a,c,d,e,f):new self.C3Html5AudioBuffer(b,
a,c,d,e)}CreateInstance(b){return"html5"===this._api?new self.C3Html5AudioInstance(this._audioDomHandler,this,b):new self.C3WebAudioInstance(this._audioDomHandler,this,b)}_Load(){}Load(){this._loadPromise||(this._loadPromise=this._Load());return this._loadPromise}IsLoaded(){}IsLoadedAndDecoded(){}HasFailedToLoad(){return"failed"===this._loadState}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetApi(){return this._api}GetOriginalUrl(){return this._originalUrl}GetUrl(){return this._url}GetContentType(){return this._type}IsMusic(){return this._isMusic}GetDuration(){}};
"use strict";
self.C3Html5AudioBuffer=class extends self.C3AudioBuffer{constructor(b,a,c,d,e){super(b,a,c,d,e);this._api="html5";this._audioElem=new Audio;this._audioElem.crossOrigin="anonymous";this._audioElem.autoplay=!1;this._audioElem.preload="auto";this._loadReject=this._loadResolve=null;this._reachedCanPlayThrough=!1;this._audioElem.addEventListener("canplaythrough",()=>this._reachedCanPlayThrough=!0);this._outNode=this.GetAudioContext().createGain();this._mediaSourceNode=null;this._audioElem.addEventListener("canplay",()=>
{this._loadResolve&&(this._loadState="loaded",this._loadResolve(),this._loadReject=this._loadResolve=null);!this._mediaSourceNode&&this._audioElem&&(this._mediaSourceNode=this.GetAudioContext().createMediaElementSource(this._audioElem),this._mediaSourceNode.connect(this._outNode))});this.onended=null;this._audioElem.addEventListener("ended",()=>{if(this.onended)this.onended()});this._audioElem.addEventListener("error",f=>this._OnError(f))}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this);
this._outNode.disconnect();this._outNode=null;this._mediaSourceNode.disconnect();this._mediaSourceNode=null;this._audioElem&&!this._audioElem.paused&&this._audioElem.pause();this._audioElem=this.onended=null;super.Release()}_Load(){this._loadState="loading";return new Promise((b,a)=>{this._loadResolve=b;this._loadReject=a;this._audioElem.src=this._url})}_OnError(b){console.error(`[Construct] Audio '${this._url}' error: `,b);this._loadReject&&(this._loadState="failed",this._loadReject(b),this._loadReject=
this._loadResolve=null)}IsLoaded(){const b=4<=this._audioElem.readyState;b&&(this._reachedCanPlayThrough=!0);return b||this._reachedCanPlayThrough}IsLoadedAndDecoded(){return this.IsLoaded()}GetAudioElement(){return this._audioElem}GetOutputNode(){return this._outNode}GetDuration(){return this._audioElem.duration}};"use strict";
self.C3WebAudioBuffer=class extends self.C3AudioBuffer{constructor(b,a,c,d,e,f){super(b,a,c,d,e);this._api="webaudio";this._audioBuffer=this._audioData=null;this._needsSoftwareDecode=!!f}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this);this._audioBuffer=this._audioData=null;super.Release()}async _Fetch(){if(this._audioData)return this._audioData;var b=this._audioDomHandler.GetRuntimeInterface();if("cordova"===b.GetExportType()&&b.IsRelativeURL(this._url)&&b.IsFileProtocol())this._audioData=
await b.CordovaFetchLocalFileAsArrayBuffer(this._url);else{b=await fetch(this._url);if(!b.ok)throw Error(`error fetching audio data: ${b.status} ${b.statusText}`);this._audioData=await b.arrayBuffer()}}async _Decode(){if(this._audioBuffer)return this._audioBuffer;this._audioBuffer=await this._audioDomHandler.DecodeAudioData(this._audioData,this._needsSoftwareDecode);this._audioData=null}async _Load(){try{this._loadState="loading",await this._Fetch(),await this._Decode(),this._loadState="loaded"}catch(b){this._loadState=
"failed",console.error(`[Construct] Failed to load audio '${this._url}': `,b)}}IsLoaded(){return!(!this._audioData&&!this._audioBuffer)}IsLoadedAndDecoded(){return!!this._audioBuffer}GetAudioBuffer(){return this._audioBuffer}GetDuration(){return this._audioBuffer?this._audioBuffer.duration:0}};"use strict";let nextAiId=0;
self.C3AudioInstance=class{constructor(b,a,c){this._audioDomHandler=b;this._buffer=a;this._tags=c;this._aiId=nextAiId++;this._gainNode=this.GetAudioContext().createGain();this._gainNode.connect(this.GetDestinationNode());this._pannerNode=null;this._isPannerEnabled=!1;this._pannerPosition=[0,0,0];this._pannerOrientation=[0,0,0];this._pannerConeParams=[0,0,0];this._stereoPannerNode=null;this._isStereoPannerEnabled=!1;this._stereoPan=0;this._isStopped=!0;this._isLooping=this._resumeMe=this._isPaused=
!1;this._volume=1;this._isMuted=!1;this._playbackRate=1;b=this._audioDomHandler.GetTimeScaleMode();this._isTimescaled=1===b&&!this.IsMusic()||2===b;this._fadeEndTime=this._instUid=-1;this._stopOnFadeEnd=!1}Release(){this._buffer=this._audioDomHandler=null;this._pannerNode&&(this._pannerNode.disconnect(),this._pannerNode=null);this._stereoPannerNode&&(this._stereoPannerNode.disconnect(),this._stereoPannerNode=null);this._gainNode.disconnect();this._gainNode=null}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}SetTags(b){this._tags=
b}GetTags(){return this._tags}GetEffectTag(){return 0<this._tags.length?this._tags[0]:""}GetDestinationNode(){return this._audioDomHandler.GetDestinationForTag(this.GetEffectTag())}GetCurrentTime(){return this._isTimescaled?this._audioDomHandler.GetGameTime():performance.now()/1E3}GetOriginalUrl(){return this._buffer.GetOriginalUrl()}GetUrl(){return this._buffer.GetUrl()}GetContentType(){return this._buffer.GetContentType()}GetBuffer(){return this._buffer}IsMusic(){return this._buffer.IsMusic()}GetAiId(){return this._aiId}HasEnded(){}CanBeRecycled(){}IsPlaying(){return!this._isStopped&&
!this._isPaused&&!this.HasEnded()}IsActive(){return!this._isStopped&&!this.HasEnded()}GetPlaybackTime(){}GetDuration(b){let a=this._buffer.GetDuration();b&&(a/=this._playbackRate||.001);return a}Play(b,a,c,d){}Stop(){}Pause(){}IsPaused(){return this._isPaused}Resume(){}SetVolume(b){this._volume=b;this._gainNode.gain.cancelScheduledValues(0);this._fadeEndTime=-1;this._gainNode.gain.value=this.GetOutputVolume()}FadeVolume(b,a,c){if(!this.IsMuted()){var d=this._gainNode.gain;d.cancelScheduledValues(0);
var e=this._audioDomHandler.GetAudioCurrentTime();a=e+a;d.setValueAtTime(d.value,e);d.linearRampToValueAtTime(b,a);this._volume=b;this._fadeEndTime=a;this._stopOnFadeEnd=c}}_UpdateVolume(){this.SetVolume(this._volume)}Tick(b){-1!==this._fadeEndTime&&b>=this._fadeEndTime&&(this._fadeEndTime=-1,this._stopOnFadeEnd&&this.Stop(),this._audioDomHandler.PostTrigger("fade-ended",this._tags,this._aiId))}GetOutputVolume(){const b=this._volume;return isFinite(b)?b:0}SetMuted(b){b=!!b;this._isMuted!==b&&(this._isMuted=
b,this._UpdateMuted())}IsMuted(){return this._isMuted}IsSilent(){return this._audioDomHandler.IsSilent()}_UpdateMuted(){}SetLooping(b){}IsLooping(){return this._isLooping}SetPlaybackRate(b){this._playbackRate!==b&&(this._playbackRate=b,this._UpdatePlaybackRate())}_UpdatePlaybackRate(){}GetPlaybackRate(){return this._playbackRate}Seek(b){}SetSuspended(b){}SetPannerEnabled(b){b=!!b;this._isPannerEnabled!==b&&((this._isPannerEnabled=b)?(this.SetStereoPannerEnabled(!1),this._pannerNode||(this._pannerNode=
this.GetAudioContext().createPanner(),this._pannerNode.panningModel=this._audioDomHandler.GetPanningModel(),this._pannerNode.distanceModel=this._audioDomHandler.GetDistanceModel(),this._pannerNode.refDistance=this._audioDomHandler.GetReferenceDistance(),this._pannerNode.maxDistance=this._audioDomHandler.GetMaxDistance(),this._pannerNode.rolloffFactor=this._audioDomHandler.GetRolloffFactor()),this._gainNode.disconnect(),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(this.GetDestinationNode())):
(this._pannerNode.disconnect(),this._gainNode.disconnect(),this._gainNode.connect(this.GetDestinationNode())))}SetPan(b,a,c,d,e,f,g){this._isPannerEnabled&&(this.SetPanXYZA(b,a,c,d),b=self.AudioDOMHandler.ToDegrees,this._pannerConeParams[0]!==b(e)&&(this._pannerConeParams[0]=b(e),this._pannerNode.coneInnerAngle=b(e)),this._pannerConeParams[1]!==b(f)&&(this._pannerConeParams[1]=b(f),this._pannerNode.coneOuterAngle=b(f)),this._pannerConeParams[2]!==g&&(this._pannerConeParams[2]=g,this._pannerNode.coneOuterGain=
g))}SetPanXYZA(b,a,c,d){if(this._isPannerEnabled){var e=this._pannerPosition,f=this._pannerOrientation,g=Math.cos(d);d=Math.sin(d);if(e[0]!==b||e[1]!==a||e[2]!==c)e[0]=b,e[1]=a,e[2]=c,this._pannerNode.setPosition(...e);if(f[0]!==g||f[1]!==d||0!==f[2])f[0]=g,f[1]=d,f[2]=0,this._pannerNode.setOrientation(...f)}}SetStereoPannerEnabled(b){b=!!b;this._isStereoPannerEnabled!==b&&((this._isStereoPannerEnabled=b)?(this.SetPannerEnabled(!1),this._stereoPannerNode=this.GetAudioContext().createStereoPanner(),
this._gainNode.disconnect(),this._gainNode.connect(this._stereoPannerNode),this._stereoPannerNode.connect(this.GetDestinationNode())):(this._stereoPannerNode.disconnect(),this._stereoPannerNode=null,this._gainNode.disconnect(),this._gainNode.connect(this.GetDestinationNode())))}SetStereoPan(b){this._isStereoPannerEnabled&&this._stereoPan!==b&&(this._stereoPan=this._stereoPannerNode.pan.value=b)}SetUID(b){this._instUid=b}GetUID(){return this._instUid}GetResumePosition(){}Reconnect(b){const a=this._stereoPannerNode||
this._pannerNode||this._gainNode;a.disconnect();a.connect(b)}GetState(){return{aiid:this.GetAiId(),tags:this._tags,duration:this.GetDuration(),volume:-1===this._fadeEndTime?this._volume:this._gainNode.gain.value,isPlaying:this.IsPlaying(),playbackTime:this.GetPlaybackTime(),playbackRate:this.GetPlaybackRate(),uid:this._instUid,bufferOriginalUrl:this.GetOriginalUrl(),bufferUrl:"",bufferType:this.GetContentType(),isMusic:this.IsMusic(),isLooping:this.IsLooping(),isMuted:this.IsMuted(),resumePosition:this.GetResumePosition(),
pan:this.GetPanState(),stereoPan:this.GetStereoPanState()}}_LoadAdditionalState(b){this.SetPlaybackRate(b.playbackRate);this.SetMuted(b.isMuted)}GetPanState(){if(!this._pannerNode)return null;const b=this._pannerNode;return{pos:this._pannerPosition,orient:this._pannerOrientation,cia:b.coneInnerAngle,coa:b.coneOuterAngle,cog:b.coneOuterGain,uid:this._instUid}}LoadPanState(b){if(b){this.SetPannerEnabled(!0);var a=this._pannerNode,c=b.pos;this._pannerPosition[0]=c[0];this._pannerPosition[1]=c[1];this._pannerPosition[2]=
c[2];c=b.orient;this._pannerOrientation[0]=c[0];this._pannerOrientation[1]=c[1];this._pannerOrientation[2]=c[2];a.setPosition(...this._pannerPosition);a.setOrientation(...this._pannerOrientation);this._pannerConeParams[0]=b.cia;this._pannerConeParams[1]=b.coa;this._pannerConeParams[2]=b.cog;a.coneInnerAngle=b.cia;a.coneOuterAngle=b.coa;a.coneOuterGain=b.cog;this._instUid=b.uid}else this.SetPannerEnabled(!1)}GetStereoPanState(){return this._stereoPannerNode?this._stereoPan:null}LoadStereoPanState(b){"number"!==
typeof b?this.SetStereoPannerEnabled(!1):(this.SetStereoPannerEnabled(!0),this.SetStereoPan(b))}};"use strict";
self.C3Html5AudioInstance=class extends self.C3AudioInstance{constructor(b,a,c){super(b,a,c);this._buffer.GetOutputNode().connect(this._gainNode);this._buffer.onended=()=>this._OnEnded()}Release(){this.Stop();this._buffer.GetOutputNode().disconnect();super.Release()}GetAudioElement(){return this._buffer.GetAudioElement()}_OnEnded(){this._isStopped=!0;this._instUid=-1;this._audioDomHandler.PostTrigger("ended",this._tags,this._aiId)}HasEnded(){return this.GetAudioElement().ended}CanBeRecycled(){return this._isStopped?
!0:this.HasEnded()}GetPlaybackTime(){let b=this.GetAudioElement().currentTime;this._isLooping||(b=Math.min(b,this.GetDuration()));return b}Play(b,a,c,d){d=this.GetAudioElement();1!==d.playbackRate&&(d.playbackRate=1);d.loop!==b&&(d.loop=b);this.SetVolume(a);d.muted&&(d.muted=!1);if(d.currentTime!==c)try{d.currentTime=c}catch(e){console.warn(`[Construct] Exception seeking audio '${this._buffer.GetUrl()}' to position '${c}': `,e)}this._audioDomHandler.TryPlayMedia(d);this._isPaused=this._isStopped=
!1;this._isLooping=b;this._playbackRate=1}Stop(){const b=this.GetAudioElement();b.paused||b.pause();this._audioDomHandler.RemovePendingPlay(b);this._isStopped=!0;this._isPaused=!1;this._instUid=-1}Pause(){if(!(this._isPaused||this._isStopped||this.HasEnded())){var b=this.GetAudioElement();b.paused||b.pause();this._audioDomHandler.RemovePendingPlay(b);this._isPaused=!0}}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._isPaused=
!1)}_UpdateMuted(){this.GetAudioElement().muted=this._isMuted||this.IsSilent()}SetLooping(b){b=!!b;this._isLooping!==b&&(this._isLooping=b,this.GetAudioElement().loop=b)}_UpdatePlaybackRate(){let b=this._playbackRate;this._isTimescaled&&(b*=this._audioDomHandler.GetTimeScale());try{this.GetAudioElement().playbackRate=b}catch(a){console.warn(`[Construct] Unable to set playback rate '${b}':`,a)}}Seek(b){if(!this._isStopped&&!this.HasEnded())try{this.GetAudioElement().currentTime=b}catch(a){console.warn(`[Construct] Error seeking audio to '${b}': `,
a)}}GetResumePosition(){return this.GetPlaybackTime()}SetSuspended(b){b?this.IsPlaying()?(this.GetAudioElement().pause(),this._resumeMe=!0):this._resumeMe=!1:this._resumeMe&&(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._resumeMe=!1)}};"use strict";
self.C3WebAudioInstance=class extends self.C3AudioInstance{constructor(b,a,c){super(b,a,c);this._bufferSource=null;this._onended_handler=d=>this._OnEnded(d);this._hasPlaybackEnded=!0;this._activeSource=null;this._resumePosition=this._playFromSeekPos=this._playStartTime=0;this._muteVol=1}Release(){this.Stop();this._ReleaseBufferSource();this._onended_handler=null;super.Release()}_ReleaseBufferSource(){this._bufferSource&&(this._bufferSource.onended=null,this._bufferSource.disconnect(),this._bufferSource.buffer=
null);this._activeSource=this._bufferSource=null}_OnEnded(b){this._isPaused||this._resumeMe||b.target!==this._activeSource||(this._isStopped=this._hasPlaybackEnded=!0,this._instUid=-1,this._ReleaseBufferSource(),this._audioDomHandler.PostTrigger("ended",this._tags,this._aiId))}HasEnded(){return!this._isStopped&&this._bufferSource&&this._bufferSource.loop||this._isPaused?!1:this._hasPlaybackEnded}CanBeRecycled(){return!this._bufferSource||this._isStopped?!0:this.HasEnded()}GetPlaybackTime(){let b;
b=this._isPaused?this._resumePosition:this._playFromSeekPos+(this.GetCurrentTime()-this._playStartTime)*this._playbackRate;this._isLooping||(b=Math.min(b,this.GetDuration()));return b}Play(b,a,c,d){this._muteVol=1;this.SetVolume(a);this._ReleaseBufferSource();this._bufferSource=this.GetAudioContext().createBufferSource();this._bufferSource.buffer=this._buffer.GetAudioBuffer();this._bufferSource.connect(this._gainNode);this._activeSource=this._bufferSource;this._bufferSource.onended=this._onended_handler;
this._bufferSource.loop=b;this._bufferSource.start(d,c);this._isPaused=this._isStopped=this._hasPlaybackEnded=!1;this._isLooping=b;this._playbackRate=1;this._playStartTime=this.GetCurrentTime();this._playFromSeekPos=c}Stop(){if(this._bufferSource)try{this._bufferSource.stop(0)}catch(b){}this._isStopped=!0;this._isPaused=!1;this._instUid=-1}Pause(){this._isPaused||this._isStopped||this.HasEnded()||(this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),
this._isPaused=!0,this._bufferSource.stop(0))}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource.start(0,this._resumePosition),
this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._isPaused=!1)}GetOutputVolume(){return super.GetOutputVolume()*this._muteVol}_UpdateMuted(){this._muteVol=this._isMuted||this.IsSilent()?0:1;this._UpdateVolume()}SetLooping(b){b=!!b;this._isLooping!==b&&(this._isLooping=b,this._bufferSource&&(this._bufferSource.loop=b))}_UpdatePlaybackRate(){let b=this._playbackRate;this._isTimescaled&&(b*=this._audioDomHandler.GetTimeScale());this._bufferSource&&(this._bufferSource.playbackRate.value=
b)}Seek(b){this._isStopped||this.HasEnded()||(this._isPaused?this._resumePosition=b:(this.Pause(),this._resumePosition=b,this.Resume()))}GetResumePosition(){return this._resumePosition}SetSuspended(b){b?this.IsPlaying()?(this._resumeMe=!0,this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._bufferSource.stop(0)):this._resumeMe=!1:this._resumeMe&&(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=
this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource.start(0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._resumeMe=!1)}_LoadAdditionalState(b){super._LoadAdditionalState(b);this._resumePosition=b.resumePosition}};"use strict";
class AudioFXBase{constructor(b){this._audioDomHandler=b;this._audioContext=b.GetAudioContext();this._index=-1;this._type=this._tag="";this._params=null}Release(){this._audioContext=null}_SetIndex(b){this._index=b}GetIndex(){return this._index}_SetTag(b){this._tag=b}GetTag(){return this._tag}CreateGain(){return this._audioContext.createGain()}GetInputNode(){}ConnectTo(b){}SetAudioParam(b,a,c,d){b.cancelScheduledValues(0);if(0===d)b.value=a;else{var e=this._audioContext.currentTime;d+=e;switch(c){case 0:b.setValueAtTime(a,
d);break;case 1:b.setValueAtTime(b.value,e);b.linearRampToValueAtTime(a,d);break;case 2:b.setValueAtTime(b.value,e),b.exponentialRampToValueAtTime(a,d)}}}GetState(){return{type:this._type,tag:this._tag,params:this._params}}}
self.C3AudioFilterFX=class extends AudioFXBase{constructor(b,a,c,d,e,f,g){super(b);this._type="filter";this._params=[a,c,d,e,f,g];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=g;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-g;this._filterNode=this._audioContext.createBiquadFilter();this._filterNode.type=a;this._filterNode.frequency.value=c;this._filterNode.detune.value=d;this._filterNode.Q.value=e;this._filterNode.gain.vlaue=f;this._inputNode.connect(this._filterNode);
this._inputNode.connect(this._dryNode);this._filterNode.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._filterNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0);this._params[5]=a;this.SetAudioParam(this._wetNode.gain,a,c,d);
this.SetAudioParam(this._dryNode.gain,1-a,c,d);break;case 1:this._params[1]=a;this.SetAudioParam(this._filterNode.frequency,a,c,d);break;case 2:this._params[2]=a;this.SetAudioParam(this._filterNode.detune,a,c,d);break;case 3:this._params[3]=a;this.SetAudioParam(this._filterNode.Q,a,c,d);break;case 4:this._params[4]=a,this.SetAudioParam(this._filterNode.gain,a,c,d)}}};
self.C3AudioDelayFX=class extends AudioFXBase{constructor(b,a,c,d){super(b);this._type="delay";this._params=[a,c,d];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=d;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-d;this._mainNode=this.CreateGain();this._delayNode=this._audioContext.createDelay(a);this._delayNode.delayTime.value=a;this._delayGainNode=this.CreateGain();this._delayGainNode.gain.value=c;this._inputNode.connect(this._mainNode);this._inputNode.connect(this._dryNode);
this._mainNode.connect(this._wetNode);this._mainNode.connect(this._delayNode);this._delayNode.connect(this._delayGainNode);this._delayGainNode.connect(this._mainNode)}Release(){this._inputNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();this._mainNode.disconnect();this._delayNode.disconnect();this._delayGainNode.disconnect();super.Release()}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,
a,c,d){const e=self.AudioDOMHandler.DbToLinear;switch(b){case 0:a=Math.max(Math.min(a/100,1),0);this._params[2]=a;this.SetAudioParam(this._wetNode.gain,a,c,d);this.SetAudioParam(this._dryNode.gain,1-a,c,d);break;case 4:this._params[1]=e(a);this.SetAudioParam(this._delayGainNode.gain,e(a),c,d);break;case 5:this._params[0]=a,this.SetAudioParam(this._delayNode.delayTime,a,c,d)}}};
self.C3AudioConvolveFX=class extends AudioFXBase{constructor(b,a,c,d){super(b);this._type="convolution";this._params=[c,d];this._bufferType=this._bufferUrl=this._bufferOriginalUrl="";this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=d;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-d;this._convolveNode=this._audioContext.createConvolver();this._convolveNode.normalize=c;this._convolveNode.buffer=a;this._inputNode.connect(this._convolveNode);this._inputNode.connect(this._dryNode);
this._convolveNode.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._convolveNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0),this._params[1]=a,this.SetAudioParam(this._wetNode.gain,a,c,d),this.SetAudioParam(this._dryNode.gain,
1-a,c,d)}}_SetBufferInfo(b,a,c){this._bufferOriginalUrl=b;this._bufferUrl=a;this._bufferType=c}GetState(){const b=super.GetState();b.bufferOriginalUrl=this._bufferOriginalUrl;b.bufferUrl="";b.bufferType=this._bufferType;return b}};
self.C3AudioFlangerFX=class extends AudioFXBase{constructor(b,a,c,d,e,f){super(b);this._type="flanger";this._params=[a,c,d,e,f];this._inputNode=this.CreateGain();this._dryNode=this.CreateGain();this._dryNode.gain.value=1-f/2;this._wetNode=this.CreateGain();this._wetNode.gain.value=f/2;this._feedbackNode=this.CreateGain();this._feedbackNode.gain.value=e;this._delayNode=this._audioContext.createDelay(a+c);this._delayNode.delayTime.value=a;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=
d;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=c;this._inputNode.connect(this._delayNode);this._inputNode.connect(this._dryNode);this._delayNode.connect(this._wetNode);this._delayNode.connect(this._feedbackNode);this._feedbackNode.connect(this._delayNode);this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._delayNode.delayTime);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._inputNode.disconnect();this._delayNode.disconnect();this._oscNode.disconnect();
this._oscGainNode.disconnect();this._dryNode.disconnect();this._wetNode.disconnect();this._feedbackNode.disconnect();super.Release()}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0);this._params[4]=a;this.SetAudioParam(this._wetNode.gain,a/2,c,d);this.SetAudioParam(this._dryNode.gain,1-a/2,c,d);break;case 6:this._params[1]=a/1E3;
this.SetAudioParam(this._oscGainNode.gain,a/1E3,c,d);break;case 7:this._params[2]=a;this.SetAudioParam(this._oscNode.frequency,a,c,d);break;case 8:this._params[3]=a/100,this.SetAudioParam(this._feedbackNode.gain,a/100,c,d)}}};
self.C3AudioPhaserFX=class extends AudioFXBase{constructor(b,a,c,d,e,f,g){super(b);this._type="phaser";this._params=[a,c,d,e,f,g];this._inputNode=this.CreateGain();this._dryNode=this.CreateGain();this._dryNode.gain.value=1-g/2;this._wetNode=this.CreateGain();this._wetNode.gain.value=g/2;this._filterNode=this._audioContext.createBiquadFilter();this._filterNode.type="allpass";this._filterNode.frequency.value=a;this._filterNode.detune.value=c;this._filterNode.Q.value=d;this._oscNode=this._audioContext.createOscillator();
this._oscNode.frequency.value=f;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=e;this._inputNode.connect(this._filterNode);this._inputNode.connect(this._dryNode);this._filterNode.connect(this._wetNode);this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._filterNode.frequency);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._inputNode.disconnect();this._filterNode.disconnect();this._oscNode.disconnect();this._oscGainNode.disconnect();this._dryNode.disconnect();
this._wetNode.disconnect();super.Release()}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0);this._params[5]=a;this.SetAudioParam(this._wetNode.gain,a/2,c,d);this.SetAudioParam(this._dryNode.gain,1-a/2,c,d);break;case 1:this._params[0]=a;this.SetAudioParam(this._filterNode.frequency,a,c,d);break;case 2:this._params[1]=a;this.SetAudioParam(this._filterNode.detune,
a,c,d);break;case 3:this._params[2]=a;this.SetAudioParam(this._filterNode.Q,a,c,d);break;case 6:this._params[3]=a;this.SetAudioParam(this._oscGainNode.gain,a,c,d);break;case 7:this._params[4]=a,this.SetAudioParam(this._oscNode.frequency,a,c,d)}}};
self.C3AudioGainFX=class extends AudioFXBase{constructor(b,a){super(b);this._type="gain";this._params=[a];this._node=this.CreateGain();this._node.gain.value=a}Release(){this._node.disconnect();super.Release()}ConnectTo(b){this._node.disconnect();this._node.connect(b)}GetInputNode(){return this._node}SetParam(b,a,c,d){const e=self.AudioDOMHandler.DbToLinear;switch(b){case 4:this._params[0]=e(a),this.SetAudioParam(this._node.gain,e(a),c,d)}}};
self.C3AudioStereoPanFX=class extends AudioFXBase{constructor(b,a){super(b);this._type="stereopan";this._params=[a];this._node=this._audioContext.createStereoPanner();this._node.pan.value=a}Release(){this._node.disconnect();super.Release()}ConnectTo(b){this._node.disconnect();this._node.connect(b)}GetInputNode(){return this._node}SetParam(b,a,c,d){a=Math.min(Math.max(a/100,-1),1);switch(b){case 9:this._params[0]=a,this.SetAudioParam(this._node.pan,a,c,d)}}};
self.C3AudioTremoloFX=class extends AudioFXBase{constructor(b,a,c){super(b);this._type="tremolo";this._params=[a,c];this._node=this.CreateGain();this._node.gain.value=1-c/2;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=a;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=c/2;this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._node.gain);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._oscNode.disconnect();this._oscGainNode.disconnect();
this._node.disconnect();super.Release()}ConnectTo(b){this._node.disconnect();this._node.connect(b)}GetInputNode(){return this._node}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0);this._params[1]=a;this.SetAudioParam(this._node.gain,1-a/2,c,d);this.SetAudioParam(this._oscGainNode.gain,a/2,c,d);break;case 7:this._params[0]=a,this.SetAudioParam(this._oscNode.frequency,a,c,d)}}};
self.C3AudioRingModFX=class extends AudioFXBase{constructor(b,a,c){super(b);this._type="ringmod";this._params=[a,c];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=c;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-c;this._ringNode=this.CreateGain();this._ringNode.gain.value=0;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=a;this._oscNode.connect(this._ringNode.gain);this._oscNode.start(0);this._inputNode.connect(this._ringNode);
this._inputNode.connect(this._dryNode);this._ringNode.connect(this._wetNode)}Release(){this._oscNode.stop(0);this._oscNode.disconnect();this._ringNode.disconnect();this._inputNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0);this._params[1]=
a;this.SetAudioParam(this._wetNode.gain,a,c,d);this.SetAudioParam(this._dryNode.gain,1-a,c,d);break;case 7:this._params[0]=a,this.SetAudioParam(this._oscNode.frequency,a,c,d)}}};
self.C3AudioDistortionFX=class extends AudioFXBase{constructor(b,a,c,d,e,f){super(b);this._type="distortion";this._params=[a,c,d,e,f];this._inputNode=this.CreateGain();this._preGain=this.CreateGain();this._postGain=this.CreateGain();this._SetDrive(d,e);this._wetNode=this.CreateGain();this._wetNode.gain.value=f;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-f;this._waveShaper=this._audioContext.createWaveShaper();this._curve=new Float32Array(65536);this._GenerateColortouchCurve(a,c);this._waveShaper.curve=
this._curve;this._inputNode.connect(this._preGain);this._inputNode.connect(this._dryNode);this._preGain.connect(this._waveShaper);this._waveShaper.connect(this._postGain);this._postGain.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._preGain.disconnect();this._waveShaper.disconnect();this._postGain.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}_SetDrive(b,a){.01>b&&(b=.01);this._preGain.gain.value=b;this._postGain.gain.value=Math.pow(1/b,.6)*
a}_GenerateColortouchCurve(b,a){for(let c=0;32768>c;++c){let d=c/32768;d=this._Shape(d,b,a);this._curve[32768+c]=d;this._curve[32768-c-1]=-d}}_Shape(b,a,c){c=1.05*c*a-a;const d=0>b?-1:1;b=0>b?-b:b;return(b<a?b:a+c*self.AudioDOMHandler.e4(b-a,1/c))*d}ConnectTo(b){this._wetNode.disconnect();this._wetNode.connect(b);this._dryNode.disconnect();this._dryNode.connect(b)}GetInputNode(){return this._inputNode}SetParam(b,a,c,d){switch(b){case 0:a=Math.max(Math.min(a/100,1),0),this._params[4]=a,this.SetAudioParam(this._wetNode.gain,
a,c,d),this.SetAudioParam(this._dryNode.gain,1-a,c,d)}}};
self.C3AudioCompressorFX=class extends AudioFXBase{constructor(b,a,c,d,e,f){super(b);this._type="compressor";this._params=[a,c,d,e,f];this._node=this._audioContext.createDynamicsCompressor();this._node.threshold.value=a;this._node.knee.value=c;this._node.ratio.value=d;this._node.attack.value=e;this._node.release.value=f}Release(){this._node.disconnect();super.Release()}ConnectTo(b){this._node.disconnect();this._node.connect(b)}GetInputNode(){return this._node}SetParam(b,a,c,d){}};
self.C3AudioAnalyserFX=class extends AudioFXBase{constructor(b,a,c){super(b);this._type="analyser";this._params=[a,c];this._node=this._audioContext.createAnalyser();this._node.fftSize=a;this._node.smoothingTimeConstant=c;this._freqBins=new Float32Array(this._node.frequencyBinCount);this._signal=new Uint8Array(a);this._rms=this._peak=0;this._audioDomHandler._AddAnalyser(this)}Release(){this._audioDomHandler._RemoveAnalyser(this);this._node.disconnect();super.Release()}Tick(){this._node.getFloatFrequencyData(this._freqBins);
this._node.getByteTimeDomainData(this._signal);const b=this._node.fftSize;let a=this._peak=0;for(var c=0;c<b;++c){let d=(this._signal[c]-128)/128;0>d&&(d=-d);this._peak<d&&(this._peak=d);a+=d*d}c=self.AudioDOMHandler.LinearToDb;this._peak=c(this._peak);this._rms=c(Math.sqrt(a/b))}ConnectTo(b){this._node.disconnect();this._node.connect(b)}GetInputNode(){return this._node}SetParam(b,a,c,d){}GetData(){return{tag:this.GetTag(),index:this.GetIndex(),peak:this._peak,rms:this._rms,binCount:this._node.frequencyBinCount,
freqBins:this._freqBins}}};"use strict";function ClearElement(b){b.replaceChildren?b.replaceChildren():b.innerHTML=""}function SetHTMLContent(b,a){b.innerHTML=a;ExecuteInsertedScripts(b)}function InsertAdjacentHTML(b,a,c){b.insertAdjacentHTML(a,c);ExecuteInsertedScripts(b)}function ExecuteInsertedScripts(b){b=Array.from(b.querySelectorAll("script:not([c3-executed])"));for(const a of b)a.parentNode.replaceChild(CloneScriptNode(a),a)}
function CloneScriptNode(b){const a=document.createElement("script");a.text=b.text;b=b.attributes;for(let c=0,d=b.length;c<d;++c){const e=b[c];a.setAttribute(e.name,e.value)}a.setAttribute("c3-executed","");return a}function elemsForSelector$jscomp$1(b,a,c){return a?c?Array.from(b.querySelectorAll(a)):(b=b.querySelector(a))?[b]:[]:[b]}function HTMLUpdateResult(b){return b?{isOk:!0,html:b.innerHTML,text:b.textContent}:{isOk:!1}}
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(b){super(b,"html-element");this.AddDOMElementMessageHandler("set-content",(a,c)=>this._OnSetContent(a,c));this.AddDOMElementMessageHandler("insert-content",(a,c)=>this._OnInsertContent(a,c));this.AddDOMElementMessageHandler("remove-content",(a,c)=>this._OnRemoveContent(a,c));this.AddDOMElementMessageHandler("set-content-class",(a,c)=>this._OnSetContentClass(a,c));this.AddDOMElementMessageHandler("set-content-attribute",
(a,c)=>this._OnSetContentAttribute(a,c));this.AddDOMElementMessageHandler("set-content-css-style",(a,c)=>this._OnSetContentCSSStyle(a,c));this.AddDOMElementMessageHandler("get-element-box",(a,c)=>this._OnGetElementBox(a,c));this.AddDOMElementMessageHandler("insert-img-element",(a,c)=>this._OnInsertImgElement(a,c));this.AddDOMElementMessageHandler("set-scroll-position",(a,c)=>this._OnSetScrollPosition(a,c))}CreateElement(b,a){const c=document.createElement(a.tag);a["style-attribute"]&&c.setAttribute("style",
a["style-attribute"]);c.style.position="absolute";var d=a["stop-input-events-mode"];if(0<d){let e=null;1===d?e=f=>{f.target!==c&&f.stopPropagation()}:2===d&&(e=f=>f.stopPropagation());c.addEventListener("pointerdown",e);c.addEventListener("pointermove",e);c.addEventListener("pointerrawupdate",e);c.addEventListener("pointerup",e);c.addEventListener("mousedown",e);c.addEventListener("mouseup",e);c.addEventListener("dblclick",e)}a["allow-context-menu"]&&c.addEventListener("contextmenu",e=>e.stopPropagation());
c.addEventListener("click",e=>{e=e.target;const f=[];for(;e;){f.push({targetId:"string"===typeof e.id?e.id:"",targetClass:"string"===typeof e.className?e.className:""});if(e===c)break;e=e.parentNode}this._PostToRuntimeElementMaybeSync("click",b,{chain:f})});c.addEventListener("animationend",e=>{const f=e.target;this._PostToRuntimeElementMaybeSync("animationend",b,{targetId:"string"===typeof f.id?f.id:"",targetClass:"string"===typeof f.className?f.className:"",animationName:e.animationName})});a.id&&
(c.id=a.id);a.className&&(c.className=a.className);a["css-color"]&&(c.style.color=a["css-color"]);a["css-background-color"]&&(c.style.backgroundColor=a["css-background-color"]);a["allow-text-selection"]||(c.style.userSelect="none",c.style.webkitUserSelect="none");d=a.str;"html"===a.type?SetHTMLContent(c,d):c.textContent=d;this._PostToRuntimeElementMaybeSync("initial-content",b,{html:c.innerHTML,text:c.textContent});return c}UpdateState(b,a){SetHTMLContent(b,a.html)}_OnSetContent(b,a){const c=a.str,
d=a.type,e=a.selector;a=a["is-all"];try{const f=elemsForSelector$jscomp$1(b,e,a);if(0===f.length)return HTMLUpdateResult(null);for(const g of f)"html"===d?SetHTMLContent(g,c):g.textContent=c;return HTMLUpdateResult(b)}catch(f){return console.warn("[HTML element] Failed to set content: ",f),HTMLUpdateResult(null)}}_OnInsertContent(b,a){const c=a.str,d=a.type,e=a["at-end"]?"beforeend":"afterbegin",f=a.selector;a=a["is-all"];try{const g=elemsForSelector$jscomp$1(b,f,a);if(0===g.length)return HTMLUpdateResult(null);
for(const h of g)"html"===d?InsertAdjacentHTML(h,e,c):h.insertAdjacentText(e,c);return HTMLUpdateResult(b)}catch(g){return console.warn("[HTML element] Failed to insert content: ",g),HTMLUpdateResult(null)}}_OnRemoveContent(b,a){const c=a["is-clear"],d=a.selector;a=a["is-all"];if(!d)return ClearElement(b),HTMLUpdateResult(b);try{const e=elemsForSelector$jscomp$1(b,d,a);if(0===e.length)return HTMLUpdateResult(null);for(const f of e)c?ClearElement(f):f.remove();return HTMLUpdateResult(b)}catch(e){return console.warn("[HTML element] Failed to remove content: ",
e),HTMLUpdateResult(null)}}_OnSetContentClass(b,a){const c=a.mode,d=a["class-array"],e=a.selector;a=a["is-all"];try{const f=elemsForSelector$jscomp$1(b,e,a);if(0===f.length)return HTMLUpdateResult(null);for(const g of f)for(const h of d)switch(c){case "add":g.classList.add(h);break;case "toggle":g.classList.toggle(h);break;case "remove":g.classList.remove(h)}return HTMLUpdateResult(b)}catch(f){return console.warn("[HTML element] Failed to set class: ",f),HTMLUpdateResult(null)}}_OnSetContentAttribute(b,
a){const c=a.mode,d=a.attribute,e=a.value,f=a.selector;a=a["is-all"];try{const g=elemsForSelector$jscomp$1(b,f,a);if(0===g.length)return HTMLUpdateResult(null);for(const h of g)switch(c){case "set":h.setAttribute(d,e);break;case "remove":h.removeAttribute(d)}return HTMLUpdateResult(b)}catch(g){return console.warn("[HTML element] Failed to set attribute: ",g),HTMLUpdateResult(null)}}_OnSetContentCSSStyle(b,a){const c=a.prop,d=a.value,e=a.selector;a=a["is-all"];try{const f=elemsForSelector$jscomp$1(b,
e,a);if(0===f.length)return HTMLUpdateResult(null);for(const g of f)c.startsWith("--")?g.style.setProperty(c,d):g.style[c]=d;return HTMLUpdateResult(b)}catch(f){return console.warn("[HTML element] Failed to set style: ",f),HTMLUpdateResult(null)}}_OnGetElementBox(b,a){b=(a=a.selector)?b.querySelector(a):b;if(!b)return{isOk:!1};b=b.getBoundingClientRect();return{isOk:!0,left:b.left,top:b.top,right:b.right,bottom:b.bottom}}_OnInsertImgElement(b,a){const c=a.blobUrl;var d=a.width;const e=a.height,f=
a.selector,g=a.insertAt;let h=b;if(f&&(h=b.querySelector(f),!h))return{isOk:!1};d=new Image(d,e);d.src=c;a.id&&(d.id=a.id);a["class"]&&(d.className=a["class"]);0===g?h.prepend(d):1===g?h.append(d):h.replaceChildren?h.replaceChildren(d):(ClearElement(h),h.append(d));return HTMLUpdateResult(b)}_OnSetScrollPosition(b,a){const c=a.selector,d=a.direction;a=a.position;if(c&&(b=b.querySelector(c),!b))return;"left"===d?b.scrollLeft=a:b.scrollTop=a}});
